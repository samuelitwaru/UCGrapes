(()=>{"use strict";class e{constructor(){this._themes=[],this._services=[],this._forms=[],this._media=[],this._currentThemeId=null,this._organisationLogo=null,this._isInitialized=!1}static getInstance(){return e.instance||(e.instance=new e),e.instance}init(e,t,n,i,a,o,s){this._isInitialized?console.warn("AppConfig already initialized - ignoring new data"):(this._themes=e,this._services=t,this._forms=n,this._media=i,this._currentThemeId=a,this._organisationLogo=o,this.addServiceButtonEvent=s,this._isInitialized=!0)}get themes(){return this._themes}get services(){return this._services}get forms(){return this._forms}get media(){return this._media}set media(e){this._media=e}get currentThemeId(){return this._currentThemeId}set currentThemeId(e){this._currentThemeId=e}get organisationLogo(){return this._organisationLogo}get isInitialized(){return this._isInitialized}}e.instance=null;class t{constructor(e,t=300){this.preloaderElement=e,this.minDuration=t,this._loading=!1,this._startTime=0,this.transitionDuration=200}get loading(){return this._loading}set loading(e){this._loading=e,e?(this._startTime=performance.now(),this.showPreloader()):this.hidePreloader()}showPreloader(){this.preloaderElement.style.display="flex",requestAnimationFrame((()=>{this.preloaderElement.style.transform=`opacity ${this.transitionDuration}ms ease-in-out 0s`,this.preloaderElement.style.opacity="1"}))}hidePreloader(){const e=performance.now()-this._startTime;e>=this.minDuration?(this.preloaderElement.style.transition=`opacity ${this.transitionDuration}ms ease-in-out`,this.preloaderElement.style.opacity="0",setTimeout((()=>{this.preloaderElement.style.display="none"}),this.transitionDuration)):setTimeout((()=>{this.hidePreloader()}),this.minDuration-e)}}var n=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};const i=window.location.origin+(window.location.origin.startsWith("http://localhost")?"/ComfortaKBDevelopmentNETSQLServer":"");class a{constructor(){this.services=[],this.forms=[],this.media=[],this.pages=[],this.preloaderEl=document.getElementById("preloader"),this.config=e.getInstance(),this.init()}init(){this.services=this.config.services,this.forms=this.config.forms,this.media=[],this.pages=[],this.getPages(),this.getMediaFiles(),this.loadingManager=new t(this.preloaderEl)}fetchAPI(e){return n(this,arguments,void 0,(function*(e,t={},n=!1){const a={headers:{"Content-Type":"application/json"}};try{n||(this.loadingManager.loading=!0);const o=yield fetch(`${i}${e}`,Object.assign(Object.assign({},a),t));if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return yield o.json()}catch(t){throw console.error(`API Error (${e}):`,t),t}finally{n||(this.loadingManager.loading=!1)}}))}debugApp(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/v2/debug",{method:"POST",body:JSON.stringify({UrlList:e})},!0)}))}getVersions(){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/v2/appversions",{},!0)}))}createVersion(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/v2/create-appversion",{method:"POST",body:JSON.stringify({AppVersionName:e})})}))}activateVersion(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/v2/activate-appversion",{method:"POST",body:JSON.stringify({AppVersionId:e})})}))}createMenuPage(e,t){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/v2/create-menu-page",{method:"POST",body:JSON.stringify({appVersionId:e,pageName:t})})}))}createServicePage(e,t){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/v2/create-service-page",{method:"POST",body:JSON.stringify({appVersionId:e,ProductServiceId:t})})}))}createContentPage(e,t){return n(this,void 0,void 0,(function*(){alert(e);const n=yield this.fetchAPI("/api/toolbox/v2/create-content-page",{method:"POST",body:JSON.stringify({appVersionId:e,PageName:t})});return console.log(n),n}))}autoSavePage(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/v2/save-page",{method:"POST",body:JSON.stringify(e)},!0)}))}getPages(){return n(this,void 0,void 0,(function*(){const e=yield this.fetchAPI("/api/toolbox/pages/list",{},!0);return this.pages=e.SDT_PageCollection,e.SDT_PageCollection}))}getServices(){return n(this,void 0,void 0,(function*(){const e=yield this.fetchAPI("/api/toolbox/services",{},!0);return this.services=e.SDT_ProductServiceCollection,this.services}))}getSinglePage(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI(`/api/toolbox/singlepage?Pageid=${e}`)}))}deletePage(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI(`/api/toolbox/deletepage?Pageid=${e}`)}))}getPagesService(){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/pages/tree")}))}createNewPage(e,t){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/create-page",{method:"POST",body:JSON.stringify({PageName:e,PageJsonContent:JSON.stringify({})})})}))}updatePage(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/update-page",{method:"POST",body:JSON.stringify(e)},!0)}))}updatePagesBatch(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/update-pages-batch",{method:"POST",body:JSON.stringify(e)})}))}addPageChild(e,t){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/add-page-children",{method:"POST",body:JSON.stringify({ParentPageId:t,ChildPageId:e})})}))}createDynamicFormPage(e,t){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/create-dynamic-form-page",{method:"POST",body:JSON.stringify({FormId:e,PageName:t})})}))}getLocationTheme(){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/location-theme")}))}updateLocationTheme(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/toolbox/update-location-theme",{method:"POST",body:JSON.stringify({ThemeId:e})})}))}getMediaFiles(){return n(this,void 0,void 0,(function*(){const e=yield this.fetchAPI("/api/toolbox/media",{},!0);return this.media=e.SDT_MediaCollection,e.SDT_MediaCollection}))}deleteMedia(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI(`/api/media/delete?MediaId=${e}`)}))}uploadFile(e,t,i,a){return n(this,void 0,void 0,(function*(){if(!e)throw new Error("Please select a file!");return yield this.fetchAPI("/api/media/upload",{method:"POST",headers:{"Content-Type":"multipart/form-data"},body:JSON.stringify({MediaName:t,MediaImageData:e,MediaSize:i,MediaType:a})},!0)}))}uploadLogo(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/media/upload/logo",{method:"POST",body:JSON.stringify({LogoUrl:e})})}))}uploadProfileImage(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI("/api/media/upload/profile",{method:"POST",body:JSON.stringify({ProfileImageUrl:e})})}))}getContentPageData(e){return n(this,void 0,void 0,(function*(){return yield this.fetchAPI(`/api/productservice?Productserviceid=${e}`,{},!0)}))}}class o{constructor(e){this.pageId=e}updateTime(){const e=new Date;let t=e.getHours();const n=t>=12?"PM":"AM";return t%=12,t=t||12,`${t}:${e.getMinutes().toString().padStart(2,"0")} ${n}`}}class s{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.classList.add("header");const e=new o("clock"),t=document.createElement("span");t.id="clock",t.textContent=e.updateTime();const n=document.createElement("span");n.classList.add("icons");const i=document.createElement("i");i.classList.add("fas","fa-signal");const a=document.createElement("i");a.classList.add("fas","fa-wifi");const s=document.createElement("i");s.classList.add("fas","fa-battery"),n.appendChild(i),n.appendChild(a),n.appendChild(s),this.container.appendChild(t),this.container.appendChild(n)}render(e){e.appendChild(this.container)}}class l{constructor(){this.container=document.createElement("div"),this.editor=new Y,this.init()}init(){this.container.classList.add("home-app-bar");const e=document.createElement("div");e.classList.add("logo-added");const t=document.createElement("img");t.src=this.editor.organisationLogo,t.style.height="35px",e.appendChild(t);const n=document.createElement("div");n.classList.add("profile-section"),n.style.display="flex",n.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="18" viewBox="0 0 19.422 21.363">\n                <path id="Path_1327" data-name="Path 1327" d="M15.711,5a6.8,6.8,0,0,0-3.793,12.442A9.739,9.739,0,0,0,6,26.364H7.942a7.769,7.769,0,1,1,15.537,0h1.942A9.739,9.739,0,0,0,19.5,17.442,6.8,6.8,0,0,0,15.711,5Zm0,1.942A4.855,4.855,0,1,1,10.855,11.8,4.841,4.841,0,0,1,15.711,6.942Z" transform="translate(-6 -5)" fill="#fff"></path>\n            </svg>\n        ',this.container.appendChild(e),this.container.appendChild(n)}render(e){e.appendChild(this.container)}}class r{constructor(){this.pageTypeSelector=this.createPageTypeSelector(),this.selectionSection=this.createSelectionSection()}render(e){const t=document.createElement("div");t.classList.add("page-selector");const n=document.createElement("div");n.classList.add("header");const i=document.createElement("h1");i.textContent="New Page",n.appendChild(i),t.appendChild(n),e.appendChild(t)}createPageTypeSelector(){return document.createElement("select")}createSelectionSection(){const e=document.createElement("div");return e.id="selection-section",e}}class c{constructor(e,t){this.containerId=t,this.paletteContainer=document.createElement("div"),this.paletteContainer.className="color-palette",this.paletteContainer.id=t,Object.entries(e).forEach((([e,t])=>{const n=document.createElement("div");n.className="color-item";const i=document.createElement("input");i.type="radio",i.id=`color-${e}`,i.name="theme-color",i.value=t;const a=document.createElement("label");a.htmlFor=`color-${e}`,a.className="color-box",a.setAttribute("data-tile-bgcolor",t),a.style.backgroundColor=t,n.appendChild(i),n.appendChild(a),n.addEventListener("click",(n=>{n.preventDefault();const a=globalThis.selectedComponent;if(!a)return;const o=a.parent(),s=o.parent(),l=globalThis.tileMapper.getTile(s.getId(),o.getId());if(null==l?void 0:l.BGImageUrl)return;const r=a.getStyle()["background-color"];a.addStyle({"background-color":r===t?"transparent":t}),a.getEl().style.backgroundColor=r===t?"transparent":t,globalThis.tileMapper.updateTile(a.parent().getId(),"BGColor",e),i.checked=r!==t})),this.paletteContainer.appendChild(n)}))}render(e){e.appendChild(this.paletteContainer)}refresh(e){const t=document.getElementById(this.containerId);t?t.replaceWith(this.paletteContainer):e.appendChild(this.paletteContainer)}}const d='\n    data-gjs-draggable="false"\n    data-gjs-selectable="true"\n    data-gjs-editable="false"\n    data-gjs-highlightable="false"\n    data-gjs-droppable="false"\n    data-gjs-resizable="false"\n    data-gjs-hoverable="false"\n',h='\n    data-gjs-draggable="true"\n    data-gjs-selectable="false"\n    data-gjs-editable="false"\n    data-gjs-highlightable="false"\n    data-gjs-droppable="false"\n    data-gjs-resizable="false"\n    data-gjs-hoverable="false"\n    data-gjs-type="tile-wrapper"\n',p='\n    data-gjs-draggable="false"\n    data-gjs-selectable="false"\n    data-gjs-editable="false"\n    data-gjs-highlightable="false"\n    data-gjs-droppable="false"\n    data-gjs-resizable="false"\n    data-gjs-hoverable="false"\n',u='\n    data-gjs-type="template-wrapper"\n    data-gjs-draggable="false"\n    data-gjs-selectable="false"\n    data-gjs-editable="false"\n    data-gjs-highlightable="true"\n    data-gjs-droppable="[data-gjs-type=\'tile-wrapper\']"\n',m='\n    data-gjs-draggable="true"\n    data-gjs-selectable="false"\n    data-gjs-editable="false"\n    data-gjs-droppable="false"\n    data-gjs-highlightable="false"\n    data-gjs-hoverable="false"\n',g='\n    data-gjs-draggable="true"\n    data-gjs-selectable="true"\n    data-gjs-editable="false"\n    data-gjs-highlightable="false"\n    data-gjs-droppable="false"\n    data-gjs-resizable="false"\n    data-gjs-hoverable="false"\n',v='\n    data-gjs-type="template-wrapper"\n    data-gjs-draggable="false"\n    data-gjs-selectable="false"\n    data-gjs-editable="false"\n    data-gjs-highlightable="true"\n    data-gjs-droppable="[data-gjs-type=\'cta-buttons\']"\n',f=e=>{let t="";for(let n=0;n<e;n++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*Math.random()));return t+(new Date).toISOString().replace(/[-:.TZ]/g,"")};class b{constructor(e){this.pageId=e}contentRow(e){return JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}"),{ContentType:e.ContentType,ContentValue:e.Content}}moveContentRow(e,t){var n;const i=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}");if(!(null===(n=null==i?void 0:i.PageContentStructure)||void 0===n?void 0:n.Content))return;const a=i.PageContentStructure.Content,o=a.findIndex((t=>t.ContentId===e));if(-1===o||t<0||t>=a.length)return;const[s]=a.splice(o,1);a.splice(t,0,s),localStorage.setItem(`data-${this.pageId}`,JSON.stringify(i))}moveCta(e,t){var n;const i=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}");if(!(null===(n=null==i?void 0:i.PageContentStructure)||void 0===n?void 0:n.Cta))return;const a=i.PageContentStructure.Cta,o=a.findIndex((t=>t.CtaId===e));if(-1===o||t<0||t>=a.length)return;const[s]=a.splice(o,1);a.splice(t,0,s),localStorage.setItem(`data-${this.pageId}`,JSON.stringify(i))}addContentCta(e){var t;const n=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}"),i={CtaId:e.CtaId,CtaType:e.CtaType,CtaLabel:e.CtaLabel,CtaAction:e.CtaAction,CtaBGColor:e.CtaBGColor,CtaButtonType:e.CtaButtonType};n.PageContentStructure.Cta||(n.PageContentStructure.Cta=[]),null===(t=null==n?void 0:n.PageContentStructure)||void 0===t||t.Cta.push(i),localStorage.setItem(`data-${this.pageId}`,JSON.stringify(n))}removeContentCta(e){const t=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}");if(t&&t.PageContentStructure&&t.PageContentStructure.Cta){const n=t.PageContentStructure.Cta.findIndex((t=>t.CtaId===e));if(-1!==n&&t.PageContentStructure.Cta[n])return t.PageContentStructure.Cta.splice(n,1),localStorage.setItem(`data-${this.pageId}`,JSON.stringify(t)),!0}}updateContentCtaBGColor(e,t){const n=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}");if(n&&n.PageContentStructure&&n.PageContentStructure.Cta){const i=n.PageContentStructure.Cta.findIndex((t=>t.CtaId===e));if(-1!==i&&n.PageContentStructure.Cta[i])return n.PageContentStructure.Cta[i].CtaBGColor=t,localStorage.setItem(`data-${this.pageId}`,JSON.stringify(n)),!0}}updateContentButtonType(e,t){const n=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}");if(n&&n.PageContentStructure&&n.PageContentStructure.Cta){const i=n.PageContentStructure.Cta.findIndex((t=>t.CtaId===e));if(-1!==i&&n.PageContentStructure.Cta[i])return n.PageContentStructure.Cta[i].CtaButtonType=t,localStorage.setItem(`data-${this.pageId}`,JSON.stringify(n)),!0}}getContentCta(e){const t=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}");if(t&&t.PageContentStructure&&t.PageContentStructure.Cta)return t.PageContentStructure.Cta.find((t=>t.CtaId===e))}}class y{constructor(){this.editor=globalThis.activeEditor;const e=globalThis.currentPageId;this.contentMapper=new b(e),this.themeManager=new S}addCtaButton(e){const t=this.editor.Components.getWrapper().find(".cta-button-container")[0];if(t){const n=f(12),{ctaButtonEl:i,ctaAction:a}=this.getIconAndAction(e,n),o={CtaId:n,CtaLabel:e.CallToActionName,CtaType:e.CallToActionType,CtaButtonType:"Round",CtaBGColor:"CtaColorOne",CtaAction:a};if(this.checkIfExisting(i)){const e=globalThis.selectedComponent;return void(e&&e.parent().getClasses().includes("cta-button-container")&&(this.contentMapper.removeContentCta(e.getId()),e.replaceWith(i),this.contentMapper.addContentCta(o)))}t.append(i),this.contentMapper.addContentCta(o)}}checkIfExisting(e){const t=document.createElement("div");t.innerHTML=e;const n=t.querySelector("[button-type]");if(!n)return!1;const i=n.getAttribute("button-type"),a=this.editor.Components.getWrapper().getEl().querySelectorAll(".cta-button-container [button-type]");return Array.from(a).some((e=>e.getAttribute("button-type")===i))}changeCtaColor(e){const t=globalThis.selectedComponent;if(!t)return;const n=t.find(".cta-styled-btn")[0];if(n){n.addStyle({"background-color":e.CtaColorCode});const t=n.parent();this.contentMapper.updateContentCtaBGColor(t.getId(),e.CtaColorName)}}changeToPlainButton(){const e=globalThis.selectedComponent;if(!e)return;const t=this.contentMapper.getContentCta(e.getId());if(console.log(t),console.log(e),t&&e){const n=`\n                <div id="${t.CtaId}" \n                    button-type="${t.CtaType}"\n                    class="plain-button-container"\n                     ${g}>\n                    <button ${p} class="plain-button cta-styled-btn"\n                        style="background-color: ${this.themeManager.getThemeCtaColor(t.CtaBGColor)}">\n                        <div ${p} id="ihd0f" class="cta-badge">\n                                <i ${p} id="i7o62" data-gjs-type="default" class="fa fa-minus"></i>\n                        </div> ${t.CtaLabel} \n                    </button>\n                </div>\n            `;null==e||e.replaceWith(n),this.contentMapper.updateContentButtonType(t.CtaId,"FullWidth")}}changeToImgButton(){const e=globalThis.selectedComponent;if(!e)return;const t=this.contentMapper.getContentCta(e.getId()),n=this.getTypeSVG(null==t?void 0:t.CtaType);if(t&&e){const i=`\n                <div id="${t.CtaId}" \n                    button-type="${t.CtaType}"\n                    ${g} \n                    data-gjs-type="cta-buttons" \n                    class="img-button-container">\n                    <div ${p} class="img-button"\n                        style="background-color: ${this.themeManager.getThemeCtaColor(t.CtaBGColor)}">\n                        <span ${p} class="img-button-icon">\n                            ${n}\n                        </span>\n                        <div${p} class="cta-badge">\n                            <i ${p} class="fa fa-minus"></i>\n                        </div>\n                        <span ${p} class="img-button-label">${t.CtaLabel}</span>\n                        <i ${p} class="fa fa-angle-right img-button-arrow"></i>\n                    </div>\n                </div>\n            `;null==e||e.replaceWith(i),this.contentMapper.updateContentButtonType(t.CtaId,"Image")}}removeCta(e){const t=e.parentElement,n=this.editor.Components.getWrapper().find("#"+(null==t?void 0:t.id))[0];if(n){const e=n.parent();null==e||e.remove(),this.contentMapper.removeContentCta(e.getId())}}getIconAndAction(e,t){let n,i;switch(null==e?void 0:e.CallToActionType){case"Phone":n=this.phoneCta(e,t),i=null==e?void 0:e.CallToActionPhoneNumber;break;case"Email":n=this.emailCta(e,t),i=null==e?void 0:e.CallToActionEmail;break;case"SiteUrl":n=this.urlCta(e,t),i=null==e?void 0:e.CallToActionUrl;break;case"Form":n=this.formCta(e,t),i=null==e?void 0:e.CallToActionUrl}return{ctaButtonEl:n,ctaAction:i}}getTypeSVG(e){let t;switch(e){case"Phone":t=`\n            <svg ${p} id="ixdtl" data-gjs-type="svg" xmlns="http://www.w3.org/2000/svg" width="32" height="32"\n                        viewBox="0 0 49.417 49.418">\n                <path ${p} id="call" data-gjs-type="svg-in"\n                    d="M29.782,3a2.149,2.149,0,1,0,0,4.3A19.3,19.3,0,0,1,49.119,26.634a2.149,2.149,0,1,0,4.3,0A23.667,23.667,0,0,0,29.782,3ZM12.032,7.305a2.548,2.548,0,0,0-.818.067,8.342,8.342,0,0,0-3.9,2.342C2.775,14.254.366,21.907,17.437,38.98S42.16,53.643,46.7,49.1a8.348,8.348,0,0,0,2.346-3.907,2.524,2.524,0,0,0-1.179-2.786c-2.424-1.418-7.654-4.484-10.08-5.9a2.523,2.523,0,0,0-2.568.012l-4.012,2.392a2.517,2.517,0,0,1-2.845-.168,65.811,65.811,0,0,1-5.711-4.981,65.07,65.07,0,0,1-4.981-5.711A2.512,2.512,0,0,1,17.5,25.2L19.9,21.191a2.533,2.533,0,0,0,.008-2.577L14.012,8.556A2.543,2.543,0,0,0,12.032,7.305Zm17.751,4.289a2.149,2.149,0,1,0,0,4.3A10.709,10.709,0,0,1,40.525,26.634a2.149,2.149,0,1,0,4.3,0A15.072,15.072,0,0,0,29.782,11.594Zm0,8.594a2.149,2.149,0,1,0,0,4.3,2.114,2.114,0,0,1,2.149,2.148,2.149,2.149,0,1,0,4.3,0A6.479,6.479,0,0,0,29.782,20.188Z"\n                    transform="translate(-4 -3)" fill="#fff"></path>\n            </svg>\n            `;break;case"Email":t=`\n            <svg ${p} id="inavf" data-gjs-type="svg" xmlns="http://www.w3.org/2000/svg" width="32"\n                height="28" viewBox="0 0 41 32.8">\n                <path ${p} id="Path_1218" data-gjs-type="svg-in" data-name="Path 1218"\n                    d="M6.1,4A4.068,4.068,0,0,0,2.789,5.7a1.5,1.5,0,0,0,.444,2.126l18,11.219a2.387,2.387,0,0,0,2.531,0L41.691,7.732a1.5,1.5,0,0,0,.384-2.2A4.063,4.063,0,0,0,38.9,4Zm35.907,8.376a.963.963,0,0,0-.508.152L23.765,23.711a2.392,2.392,0,0,1-2.531,0L3.5,12.656a.98.98,0,0,0-1.5.833V32.7a4.1,4.1,0,0,0,4.1,4.1H38.9A4.1,4.1,0,0,0,43,32.7V13.357A.981.981,0,0,0,42.007,12.376Z"\n                    transform="translate(-2 -4)" fill="#fff"></path>\n            </svg>\n            `;break;case"SiteUrl":t=`\n            <svg ${p} xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16">\n                <path${p} id="Path_1213" data-name="Path 1213" d="M15.833,4a4.163,4.163,0,0,0-2.958,1.229l-.979.979a4.168,4.168,0,0,0-1.229,2.958,4.1,4.1,0,0,0,.292,1.521L12.042,9.6a2.857,2.857,0,0,1,.792-2.458l.979-.979a2.853,2.853,0,0,1,2.021-.833,2.805,2.805,0,0,1,2,.833,2.85,2.85,0,0,1,0,4.021l-.979.979A2.853,2.853,0,0,1,14.833,12a2.439,2.439,0,0,1-.437-.042l-1.083,1.083a4.1,4.1,0,0,0,1.521.292A4.163,4.163,0,0,0,17.792,12.1l.979-.979A4.168,4.168,0,0,0,20,8.167,4.2,4.2,0,0,0,15.833,4ZM14.188,8.854,8.854,14.188l.958.958,5.333-5.333ZM9.167,10.667A4.163,4.163,0,0,0,6.208,11.9l-.979.979A4.168,4.168,0,0,0,4,15.833,4.2,4.2,0,0,0,8.167,20a4.163,4.163,0,0,0,2.958-1.229l.979-.979a4.168,4.168,0,0,0,1.229-2.958,4.1,4.1,0,0,0-.292-1.521L11.958,14.4a2.857,2.857,0,0,1-.792,2.458l-.979.979a2.853,2.853,0,0,1-2.021.833,2.805,2.805,0,0,1-2-.833,2.85,2.85,0,0,1,0-4.021l.979-.979A2.853,2.853,0,0,1,9.167,12a2.44,2.44,0,0,1,.438.042l1.083-1.083A4.1,4.1,0,0,0,9.167,10.667Z" transform="translate(-4 -4)" fill="#fff"></path>\n            </svg>\n            `;break;case"Form":t=`\n            <svg ${p} id="igqdh" data-gjs-type="svg" xmlns="http://www.w3.org/2000/svg" width="26" height="30"\n                  viewBox="0 0 13 16">\n                  <path ${p} id="Path_1209" data-gjs-type="svg-in" data-name="Path 1209"\n                      d="M9.828,4A1.823,1.823,0,0,0,8,5.8V18.2A1.823,1.823,0,0,0,9.828,20h9.344A1.823,1.823,0,0,0,21,18.2V9.8a.6.6,0,0,0-.179-.424l-.006-.006L15.54,4.176A.614.614,0,0,0,15.109,4Zm0,1.2H14.5V8.6a1.823,1.823,0,0,0,1.828,1.8h3.453v7.8a.6.6,0,0,1-.609.6H9.828a.6.6,0,0,1-.609-.6V5.8A.6.6,0,0,1,9.828,5.2Zm5.891.848L18.92,9.2H16.328a.6.6,0,0,1-.609-.6Z"\n                      transform="translate(-8 -4)" fill="#fff"></path>\n              </svg>\n            `}return t}phoneCta(e,t){return`\n        <div ${g} data-gjs-type="cta-buttons" button-type="${e.CallToActionType}" class="cta-container-child cta-child" id="${t}">\n            <div ${p} data-gjs-type="default" class="cta-button cta-styled-btn"\n                style="background-color: ${this.themeManager.getThemeCtaColor("CtaColorOne")}">\n                <svg ${p} id="ixdtl" data-gjs-type="svg" xmlns="http://www.w3.org/2000/svg" width="32" height="32"\n                    viewBox="0 0 49.417 49.418">\n                    <path ${p} id="call" data-gjs-type="svg-in"\n                        d="M29.782,3a2.149,2.149,0,1,0,0,4.3A19.3,19.3,0,0,1,49.119,26.634a2.149,2.149,0,1,0,4.3,0A23.667,23.667,0,0,0,29.782,3ZM12.032,7.305a2.548,2.548,0,0,0-.818.067,8.342,8.342,0,0,0-3.9,2.342C2.775,14.254.366,21.907,17.437,38.98S42.16,53.643,46.7,49.1a8.348,8.348,0,0,0,2.346-3.907,2.524,2.524,0,0,0-1.179-2.786c-2.424-1.418-7.654-4.484-10.08-5.9a2.523,2.523,0,0,0-2.568.012l-4.012,2.392a2.517,2.517,0,0,1-2.845-.168,65.811,65.811,0,0,1-5.711-4.981,65.07,65.07,0,0,1-4.981-5.711A2.512,2.512,0,0,1,17.5,25.2L19.9,21.191a2.533,2.533,0,0,0,.008-2.577L14.012,8.556A2.543,2.543,0,0,0,12.032,7.305Zm17.751,4.289a2.149,2.149,0,1,0,0,4.3A10.709,10.709,0,0,1,40.525,26.634a2.149,2.149,0,1,0,4.3,0A15.072,15.072,0,0,0,29.782,11.594Zm0,8.594a2.149,2.149,0,1,0,0,4.3,2.114,2.114,0,0,1,2.149,2.148,2.149,2.149,0,1,0,4.3,0A6.479,6.479,0,0,0,29.782,20.188Z"\n                        transform="translate(-4 -3)" fill="#fff"></path>\n                </svg>\n                <div ${p} id="it1cq" data-gjs-type="default" class="cta-badge">\n                    <i ${p} id="ityrb" data-gjs-type="default" class="fa fa-minus"></i>\n                </div>\n            </div>\n            <div ${p} id="irtak" data-gjs-type="text" class="cta-label">${e.CallToActionName}</div>\n        </div>\n        `}emailCta(e,t){return`\n        <div ${g} data-gjs-type="cta-buttons"  button-type="${e.CallToActionType}" class="cta-container-child cta-child" id="${t}">\n            <div ${p} id="i4iaf" data-gjs-type="default" class="cta-button cta-styled-btn"\n                style="background-color: ${this.themeManager.getThemeCtaColor("CtaColorOne")}">\n                <svg ${p} id="inavf" data-gjs-type="svg" xmlns="http://www.w3.org/2000/svg" width="32"\n                    height="28" viewBox="0 0 41 32.8">\n                    <path ${p} id="Path_1218" data-gjs-type="svg-in" data-name="Path 1218"\n                        d="M6.1,4A4.068,4.068,0,0,0,2.789,5.7a1.5,1.5,0,0,0,.444,2.126l18,11.219a2.387,2.387,0,0,0,2.531,0L41.691,7.732a1.5,1.5,0,0,0,.384-2.2A4.063,4.063,0,0,0,38.9,4Zm35.907,8.376a.963.963,0,0,0-.508.152L23.765,23.711a2.392,2.392,0,0,1-2.531,0L3.5,12.656a.98.98,0,0,0-1.5.833V32.7a4.1,4.1,0,0,0,4.1,4.1H38.9A4.1,4.1,0,0,0,43,32.7V13.357A.981.981,0,0,0,42.007,12.376Z"\n                        transform="translate(-2 -4)" fill="#fff"></path>\n                </svg>\n                <div ${p} id="i2knu" data-gjs-type="default" class="cta-badge">\n                    <i ${p} id="idkak" data-gjs-type="default" class="fa fa-minus"></i>\n                </div>\n            </div>\n            <div ${p} id="irtak" data-gjs-type="text" class="cta-label">${e.CallToActionName}</div>\n        </div>\n        `}formCta(e,t){return`\n        <div ${g} data-gjs-type="cta-buttons"  button-type="${e.CallToActionType}" class="cta-container-child cta-child" id="${t}">\n            <div ${p} id="i9rww" data-gjs-type="default" class="cta-button cta-styled-btn"\n                style="background-color: ${this.themeManager.getThemeCtaColor("CtaColorOne")}">\n                <svg ${p} id="igqdh" data-gjs-type="svg" xmlns="http://www.w3.org/2000/svg" width="26" height="30"\n                    viewBox="0 0 13 16">\n                    <path ${p} id="Path_1209" data-gjs-type="svg-in" data-name="Path 1209"\n                        d="M9.828,4A1.823,1.823,0,0,0,8,5.8V18.2A1.823,1.823,0,0,0,9.828,20h9.344A1.823,1.823,0,0,0,21,18.2V9.8a.6.6,0,0,0-.179-.424l-.006-.006L15.54,4.176A.614.614,0,0,0,15.109,4Zm0,1.2H14.5V8.6a1.823,1.823,0,0,0,1.828,1.8h3.453v7.8a.6.6,0,0,1-.609.6H9.828a.6.6,0,0,1-.609-.6V5.8A.6.6,0,0,1,9.828,5.2Zm5.891.848L18.92,9.2H16.328a.6.6,0,0,1-.609-.6Z"\n                        transform="translate(-8 -4)" fill="#fff"></path>\n                </svg>\n                <div ${p} id="iina3" data-gjs-type="default" class="cta-badge">\n                    <i ${p} id="iw1yc" data-gjs-type="default" class="fa fa-minus"></i>\n                </div>\n            </div>\n            <div ${p} id="irtak" data-gjs-type="text" class="cta-label">${e.CallToActionName}</div>\n        </div>\n        `}urlCta(e,t){return`\n        <div ${g} data-gjs-type="cta-buttons"  button-type="${e.CallToActionType}" class="cta-container-child cta-child" id="${t}">\n            <div ${p} id="i4iaf" data-gjs-type="default" class="cta-button cta-styled-btn"\n                style="background-color: ${this.themeManager.getThemeCtaColor("CtaColorOne")}">\n                <svg ${p} xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16">\n                    <path${p} id="Path_1213" data-name="Path 1213" d="M15.833,4a4.163,4.163,0,0,0-2.958,1.229l-.979.979a4.168,4.168,0,0,0-1.229,2.958,4.1,4.1,0,0,0,.292,1.521L12.042,9.6a2.857,2.857,0,0,1,.792-2.458l.979-.979a2.853,2.853,0,0,1,2.021-.833,2.805,2.805,0,0,1,2,.833,2.85,2.85,0,0,1,0,4.021l-.979.979A2.853,2.853,0,0,1,14.833,12a2.439,2.439,0,0,1-.437-.042l-1.083,1.083a4.1,4.1,0,0,0,1.521.292A4.163,4.163,0,0,0,17.792,12.1l.979-.979A4.168,4.168,0,0,0,20,8.167,4.2,4.2,0,0,0,15.833,4ZM14.188,8.854,8.854,14.188l.958.958,5.333-5.333ZM9.167,10.667A4.163,4.163,0,0,0,6.208,11.9l-.979.979A4.168,4.168,0,0,0,4,15.833,4.2,4.2,0,0,0,8.167,20a4.163,4.163,0,0,0,2.958-1.229l.979-.979a4.168,4.168,0,0,0,1.229-2.958,4.1,4.1,0,0,0-.292-1.521L11.958,14.4a2.857,2.857,0,0,1-.792,2.458l-.979.979a2.853,2.853,0,0,1-2.021.833,2.805,2.805,0,0,1-2-.833,2.85,2.85,0,0,1,0-4.021l.979-.979A2.853,2.853,0,0,1,9.167,12a2.44,2.44,0,0,1,.438.042l1.083-1.083A4.1,4.1,0,0,0,9.167,10.667Z" transform="translate(-4 -4)" fill="#fff"></path>\n                </svg>\n                <div ${p} id="i2knu" data-gjs-type="default" class="cta-badge">\n                    <i ${p} id="idkak" data-gjs-type="default" class="fa fa-minus"></i>\n                </div>\n            </div>\n            <div ${p} id="irtak" data-gjs-type="text" class="cta-label">${e.CallToActionName}</div>\n        </div>\n        `}}class C{constructor(e){this.colorList=e,this.ctaManager=new y,this.container=document.createElement("div"),this.init()}init(){this.container.classList.add("cta-style"),this.container.id="cta-style",this.container.style.display="flex";const e=document.createElement("div");e.classList.add("text-color-palette"),e.classList.add("text-colors"),e.id="cta-color-palette",this.colorList.forEach((t=>{const n=document.createElement("div");n.classList.add("color-item");const i=document.createElement("input");i.type="radio",i.name="cta-color",i.value=t.CtaColorCode,i.id=t.CtaColorCode;const a=document.createElement("label");a.setAttribute("for",t.CtaColorCode),a.classList.add("color-box"),a.style.backgroundColor=t.CtaColorCode,n.appendChild(i),n.appendChild(a),e.appendChild(n),i.addEventListener("click",(()=>{this.ctaManager.changeCtaColor(t)})),e.appendChild(n)})),this.container.appendChild(e)}render(e){e.appendChild(this.container)}refresh(e){const t=document.getElementById("cta-style");t?t.replaceWith(this.container):e.appendChild(this.container)}}class w{constructor(e,t){this.icons=[],this.iconsCategory="General",this.themeManager=e,this.iconsCategory=t,this.init()}init(){this.icons=[];const e=this.themeManager.getActiveThemeIcons();this.themeManager.currentTheme,e.filter((e=>e.IconCategory===this.iconsCategory)).forEach((e=>{const t=document.createElement("div");t.classList.add("icon"),t.title=e.IconName,t.innerHTML=`${e.IconSVG}`,t.addEventListener("click",(t=>{var n;t.preventDefault();const i=globalThis.selectedComponent;if(!i)return;const a=i.find(".tile-icon")[0];if(!a)return;const o=null===(n=i.getStyle())||void 0===n?void 0:n.color,s=e.IconSVG.replace(/fill="#[^"]*"/g,`fill="${o||"white"}"`).replace("<svg",`<svg ${p}`);a.components(s),a.parent().addStyle({display:"block"}),globalThis.tileMapper.updateTile(i.parent().getId(),"Icon",e.IconName)})),this.icons.push(t)}))}render(e){this.icons.forEach((t=>e.appendChild(t)))}}class T{constructor(){this.themes=[],this.config=e.getInstance()}getActiveVersion(){return e=this,t=void 0,i=function*(){var e;const t=new a,n=yield t.getVersions();return(null===(e=null==n?void 0:n.AppVersions)||void 0===e?void 0:e.find((e=>e.IsActive)))||null},new((n=void 0)||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}));var e,t,n,i}}var E=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class S{constructor(){this.themes=[],this.config=e.getInstance(),this.appVersionManager=new T,this.setThemes(this.config.themes)}setThemes(e){this.themes=e,this.currentTheme=this.getThemes().find((e=>e.ThemeId===this.config.currentThemeId))}getThemes(){return this.themes}getActiveThemeIcons(){return this.currentTheme?this.currentTheme.ThemeIcons:[]}getActiveThemeColors(){return this.currentTheme?this.currentTheme.ThemeColors:{}}getActiveThemeCtaColors(){return this.currentTheme?this.currentTheme.ThemeCtaColors:{}}setTheme(e){this.config.currentThemeId=e.ThemeId,this.updateColorPallete(e.ThemeColors),this.updateCtaColorPallete(e.ThemeCtaColors),this.updateThemeIcons(),this.applyTheme(e)}updateColorPallete(e){const t=new c(e,"theme-color-palette"),n=document.querySelector(".sidebar-section .theme-section");t.refresh(n)}updateCtaColorPallete(e){const t=new C(e),n=document.getElementById("content-page-section");t.refresh(n)}updateThemeIcons(){const e=document.getElementById("icons-list");e.classList.add("icons-list"),e.id="icons-list",e.innerHTML="",new w(this,"General").render(e)}getThemeColor(e){return this.currentTheme&&this.currentTheme.ThemeColors?this.currentTheme.ThemeColors[e]||"transparent":(console.error("ThemeColors is undefined or invalid:",this.currentTheme),null)}getThemeCtaColor(e){var t;return this.currentTheme&&this.currentTheme.ThemeCtaColors?(null===(t=this.currentTheme.ThemeCtaColors.find((t=>t.CtaColorName===e)))||void 0===t?void 0:t.CtaColorCode)||"#5068a8":(console.error("ThemeColors is undefined or invalid:",this.currentTheme),null)}applyTheme(e){return E(this,void 0,void 0,(function*(){const t=document.querySelectorAll(".mobile-frame iframe");if(!t.length)return;const n=yield this.appVersionManager.getActiveVersion();n&&n.Pages.forEach((n=>E(this,void 0,void 0,(function*(){var i;const a=`data-${n.PageId}`,o=JSON.parse(localStorage.getItem(a)||"{}");o.PageMenuStructure&&(null===(i=o.PageMenuStructure)||void 0===i?void 0:i.Rows).forEach((n=>{n.Tiles.forEach((n=>{n.BGColor&&t.forEach((t=>{var i,a;const o=t.contentDocument||(null===(i=t.contentWindow)||void 0===i?void 0:i.document);if(o){this.updateFontFamily(o,e.ThemeFontFamily);const t=o.getElementById(n.Id);if(t){const i=t.querySelector(".template-block");i&&i.setAttribute("style",`background-color: ${null===(a=null==e?void 0:e.ThemeColors)||void 0===a?void 0:a[n.BGColor]};`)}}}))}))}))}))))}))}updateFontFamily(e,t="Comic Sans MS"){try{e.documentElement.style.setProperty("--font-family",t)}catch(e){console.error("Error updating font family:",e)}}}class I{constructor(e){this.modalContainer=document.createElement("div"),this.modalContainer.className="popup-modal-link",this.modalContainer.style.display="flex";const t=document.createElement("div");t.className="popup",e.width&&(t.style.width=e.width);const n=document.createElement("div");n.className="popup-header";const i=document.createElement("span");i.textContent=e.title;const a=document.createElement("hr");this.popupBody=document.createElement("div"),this.popupBody.className="popup-body",e.body&&("string"==typeof e.body?this.popupBody.innerHTML=e.body:this.popupBody.appendChild(e.body));const o=this.createCloseButton();n.appendChild(i),n.appendChild(o),t.appendChild(n),t.appendChild(a),t.appendChild(this.popupBody),this.modalContainer.appendChild(t)}createCloseButton(){const e=document.createElement("button");return e.className="close",e.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 21 21">\n                <path id="Icon_material-close" data-name="Icon material-close" d="M28.5,9.615,26.385,7.5,18,15.885,9.615,7.5,7.5,9.615,15.885,18,7.5,26.385,9.615,28.5,18,20.115,26.385,28.5,28.5,26.385,20.115,18Z" transform="translate(-7.5 -7.5)" fill="#6a747f" opacity="0.54"></path>\n            </svg>\n        ',e.addEventListener("click",(()=>this.close())),e}open(e){(e||document.body).appendChild(this.modalContainer)}close(){this.modalContainer.remove()}}var P=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class L{constructor(){this.toolboxService=new a}renderForm(){const e=document.createElement("form"),t=document.createElement("div");this.errorLabel=document.createElement("label"),this.errorLabel.style.color="red",t.appendChild(this.errorLabel),e.appendChild(t);const n=document.createElement("label");n.textContent="Select CTA Type",e.appendChild(n),this.ctaSelectInput=document.createElement("select"),this.ctaSelectInput.classList.add("tb-form-control"),e.appendChild(this.ctaSelectInput),[{value:"Phone",text:"Phone"},{value:"Email",text:"Email"},{value:"Form",text:"Form"},{value:"Url",text:"Url"}].forEach((e=>{var t;const n=document.createElement("option");n.value=e.value,n.text=e.text,null===(t=this.ctaSelectInput)||void 0===t||t.appendChild(n)}));const i=document.createElement("label");i.textContent="Label *",e.appendChild(i),this.ctaLabelInput=document.createElement("input"),this.ctaLabelInput.classList.add("tb-form-control"),this.ctaLabelInput.type="text",this.ctaLabelInput.placeholder="Label",e.appendChild(this.ctaLabelInput);const a=document.createElement("div");a.id="cta-value-div",e.appendChild(a),this.changeCTAValueInput(this.ctaSelectInput.value,a),this.ctaSelectInput.addEventListener("change",(e=>{const t=e.target.value;this.changeCTAValueInput(t,a)}));const o=document.getElementById("create-cta-container");null==o||o.appendChild(e);const s=this.renderModalFooter();null==o||o.appendChild(s)}changeCTAValueInput(e,t){return P(this,void 0,void 0,(function*(){t.innerHTML="";const n=document.createElement("label");n.textContent=`${e} *`,t.appendChild(n),"Form"===e?(this.formSelect=document.createElement("select"),this.formSelect.classList.add("tb-form-control"),this.formSelect.id="form-select",t.appendChild(this.formSelect),this.toolboxService.forms.forEach((e=>{var t;const n=document.createElement("option");n.value=e.FormUrl,n.text=e.ReferenceName,null===(t=this.formSelect)||void 0===t||t.appendChild(n)}))):"Phone"===e?(this.phoneInput=yield this.renderPhoneInput(),t.appendChild(this.phoneInput)):"Email"===e?(this.emailInput=document.createElement("input"),this.emailInput.classList.add("tb-form-control"),this.emailInput.type="email",t.appendChild(this.emailInput)):"Url"===e&&(this.urlInput=document.createElement("input"),this.urlInput.classList.add("tb-form-control"),this.urlInput.type="url",t.appendChild(this.urlInput))}))}renderModalFooter(){const e=document.createElement("div");e.classList.add("popup-footer"),e.style.marginBottom="-12px";const t=document.createElement("button");t.classList.add("tb-btn","tb-btn-primary"),t.innerText="Add CTA",e.appendChild(t);const n=document.createElement("button");return n.classList.add("tb-btn","tb-btn-secondary"),n.innerText="Cancel",n.addEventListener("click",(e=>{var t;null===(t=this.modal)||void 0===t||t.close()})),t.addEventListener("click",(e=>{this.addCtaToPage()})),e.appendChild(n),e.appendChild(t),e.appendChild(n),e}showPopup(){this.modal=new I({title:"Create CTA",body:'<div id="create-cta-container"></div>'}),this.modal.open(),this.renderForm()}renderPhoneInput(){return P(this,void 0,void 0,(function*(){const e=document.createElement("div");e.style.display="flex",e.style.gap="2px";const t=document.createElement("select");t.classList.add("tb-form-control"),t.style.width="100px";const n=document.createElement("input");n.type="number",n.placeholder="Enter phone number",n.classList.add("tb-form-control");try{const i=yield fetch("https://restcountries.com/v3.1/all");(yield i.json()).filter((e=>{var t;return null===(t=e.idd)||void 0===t?void 0:t.root})).map((e=>({code:`${e.idd.root}${e.idd.suffixes?e.idd.suffixes[0]:""}`,name:e.name.common,flag:e.flags.svg}))).sort(((e,t)=>e.name.localeCompare(t.name))).forEach((({code:e,name:n,flag:i})=>{const a=document.createElement("option");a.value=e,a.innerHTML=`(${e}) ${n}`,t.appendChild(a)})),e.appendChild(t),e.appendChild(n)}catch(e){console.error("Error fetching country data:",e),t.innerHTML="<option>Error loading codes</option>"}return e}))}addCtaToPage(){var e,t,n,i,a,o,s,l,r,c,d,h;const p={CtaId:f(5),CtaLabel:null===(e=this.ctaLabelInput)||void 0===e?void 0:e.value,CtaType:null===(t=this.ctaSelectInput)||void 0===t?void 0:t.value,CtaValue:""};"Form"===(null===(n=this.ctaSelectInput)||void 0===n?void 0:n.value)?p.CtaValue=(null===(i=this.formSelect)||void 0===i?void 0:i.value)||"":"Phone"===(null===(a=this.ctaSelectInput)||void 0===a?void 0:a.value)?p.CtaValue=(null===(s=null===(o=this.phoneInput)||void 0===o?void 0:o.querySelector("input"))||void 0===s?void 0:s.value)||"":"Email"===(null===(l=this.ctaSelectInput)||void 0===l?void 0:l.value)?p.CtaValue=(null===(r=this.emailInput)||void 0===r?void 0:r.value)||"":"Url"===(null===(c=this.ctaSelectInput)||void 0===c?void 0:c.value)&&(p.CtaValue=(null===(d=this.urlInput)||void 0===d?void 0:d.value)||"");const u=this.validateCta(p);if(u.isValid){console.log(p);const e=globalThis.activeEditor;if(e){const t=e.DomComponents.getWrapper().find(".content-page-wrapper");t.length>0&&t[0].append(this.generateCta(p)),null===(h=this.modal)||void 0===h||h.close()}}else this.errorLabel&&(this.errorLabel.textContent=u.message)}validateCta(e){const t=/^\d{10}$/,n=/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w .-]*)*\/?$/,i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!e.CtaLabel||!e.CtaType||!e.CtaValue)return{isValid:!1,message:`Type, Label, and ${e.CtaType} are required.`};switch(e.CtaType){case"Phone":if(!t.test(e.CtaValue))return{isValid:!1,message:"CtaValue must be a 10-digit number for Phone type."};break;case"Url":case"Form":if(!n.test(e.CtaValue))return{isValid:!1,message:"CtaValue must be a valid URL for Url or Form type."};break;case"Email":if(!i.test(e.CtaValue))return{isValid:!1,message:"CtaValue must be a valid email address for Email type."};break;default:return{isValid:!1,message:"Invalid CtaType."}}return{isValid:!0,message:"Validation successful."}}generateCta(e){let t="";switch(e.CtaType){case"Phone":case"Email":case"Url":case"Form":t=""}return`\n        <div ${d} data-gjs-type="cta-buttons" cta-button-label="${e.CtaLabel}" cta-button-type="${e.CtaType}" cta-button-action="${e.CtaValue}" cta-background-color="#b2b997" class="cta-container-child cta-child">\n            <div class="cta-button" ${p}>\n                ${t}\n                <div class="cta-badge" ${p}><i ${p} data-gjs-type="default" class="fa fa-minus"></i></div>\n            </div>\n            <div class="cta-label" ${p}>${e.CtaLabel}</div>\n        </div>\n        `}}class A{constructor(){this.ctaManager=new y,this.container=document.createElement("div"),this.init()}init(){this.container.classList.add("cta-button-layout-container"),this.container.style.display="flex";const e=document.createElement("button");e.classList.add("tb-btn","cta-button-layout"),e.id="plain-button-layout",e.innerText="Button";const t=document.createElement("button");t.classList.add("tb-btn","cta-button-layout"),t.id="image-button-layout",t.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40.999 28.865">\n                <path id="Path_1040" data-name="Path 1040" d="M21.924,11.025a3.459,3.459,0,0,0-3.287,3.608,3.459,3.459,0,0,0,3.287,3.608,3.459,3.459,0,0,0,3.287-3.608A3.459,3.459,0,0,0,21.924,11.025ZM36.716,21.849l-11.5,14.432-8.218-9.02L8.044,39.89h41Z" transform="translate(-8.044 -11.025)" fill="#4c5357"></path>\n            </svg>\n            Button\n        ',e.addEventListener("click",(e=>{e.preventDefault(),this.ctaManager.changeToPlainButton()})),t.addEventListener("click",(e=>{e.preventDefault(),this.ctaManager.changeToImgButton()})),this.container.appendChild(e),this.container.appendChild(t)}render(e){e.appendChild(this.container)}}class x{constructor(e){this.iconsList=e,this.ctaManager=new y,this.container=document.createElement("div"),this.init()}init(){var e;this.container.id="call-to-actions",null===(e=this.iconsList)||void 0===e||e.forEach((e=>{const t=document.createElement("div");t.className="call-to-action-item",t.title=e.CallToActionName,"Phone"===e.CallToActionType?t.innerHTML=M.phone:"Email"===e.CallToActionType?t.innerHTML=M.email:"SiteUrl"===e.CallToActionType?t.innerHTML=M.website_url:"Map"===e.CallToActionType||"Form"===e.CallToActionType&&(t.innerHTML=M.form),t.addEventListener("click",(()=>{this.ctaManager.addCtaButton(e)})),this.container.appendChild(t)}))}render(e){const t=e.querySelector("#call-to-actions");t&&t.remove(),e.appendChild(this.container)}}const M={phone:'<svg data-gjs-draggable="false" data-gjs-selectable="false" data-gjs-editable="false" data-gjs-highlightable="false" data-gjs-droppable="false" data-gjs-resizable="false" data-gjs-hoverable="false" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 49.417 49.418">\n                <path data-gjs-draggable="false" data-gjs-selectable="false" data-gjs-editable="false" data-gjs-highlightable="false" data-gjs-droppable="false" data-gjs-resizable="false" data-gjs-hoverable="false" id="call" d="M29.782,3a2.149,2.149,0,1,0,0,4.3A19.3,19.3,0,0,1,49.119,26.634a2.149,2.149,0,1,0,4.3,0A23.667,23.667,0,0,0,29.782,3ZM12.032,7.305a2.548,2.548,0,0,0-.818.067,8.342,8.342,0,0,0-3.9,2.342C2.775,14.254.366,21.907,17.437,38.98S42.16,53.643,46.7,49.1a8.348,8.348,0,0,0,2.346-3.907,2.524,2.524,0,0,0-1.179-2.786c-2.424-1.418-7.654-4.484-10.08-5.9a2.523,2.523,0,0,0-2.568.012l-4.012,2.392a2.517,2.517,0,0,1-2.845-.168,65.811,65.811,0,0,1-5.711-4.981,65.07,65.07,0,0,1-4.981-5.711A2.512,2.512,0,0,1,17.5,25.2L19.9,21.191a2.533,2.533,0,0,0,.008-2.577L14.012,8.556A2.543,2.543,0,0,0,12.032,7.305Zm17.751,4.289a2.149,2.149,0,1,0,0,4.3A10.709,10.709,0,0,1,40.525,26.634a2.149,2.149,0,1,0,4.3,0A15.072,15.072,0,0,0,29.782,11.594Zm0,8.594a2.149,2.149,0,1,0,0,4.3,2.114,2.114,0,0,1,2.149,2.148,2.149,2.149,0,1,0,4.3,0A6.479,6.479,0,0,0,29.782,20.188Z" transform="translate(-4 -3)" fill="#fff"></path>\n            </svg>',email:'<svg data-gjs-draggable="false" data-gjs-selectable="false" data-gjs-editable="false" data-gjs-highlightable="false" data-gjs-droppable="false" data-gjs-resizable="false" data-gjs-hoverable="false" xmlns="http://www.w3.org/2000/svg" width="32" height="28" viewBox="0 0 41 32.8">\n                <path data-gjs-draggable="false" data-gjs-selectable="false" data-gjs-editable="false" data-gjs-highlightable="false" data-gjs-droppable="false" data-gjs-resizable="false" data-gjs-hoverable="false" id="Path_1218" data-name="Path 1218" d="M6.1,4A4.068,4.068,0,0,0,2.789,5.7a1.5,1.5,0,0,0,.444,2.126l18,11.219a2.387,2.387,0,0,0,2.531,0L41.691,7.732a1.5,1.5,0,0,0,.384-2.2A4.063,4.063,0,0,0,38.9,4Zm35.907,8.376a.963.963,0,0,0-.508.152L23.765,23.711a2.392,2.392,0,0,1-2.531,0L3.5,12.656a.98.98,0,0,0-1.5.833V32.7a4.1,4.1,0,0,0,4.1,4.1H38.9A4.1,4.1,0,0,0,43,32.7V13.357A.981.981,0,0,0,42.007,12.376Z" transform="translate(-2 -4)" fill="#fff"></path>\n            </svg>',form:'<svg xmlns="http://www.w3.org/2000/svg" width="13" height="16" viewBox="0 0 13 16">\n            <path id="Path_1209" data-name="Path 1209" d="M9.828,4A1.823,1.823,0,0,0,8,5.8V18.2A1.823,1.823,0,0,0,9.828,20h9.344A1.823,1.823,0,0,0,21,18.2V9.8a.6.6,0,0,0-.179-.424l-.006-.006L15.54,4.176A.614.614,0,0,0,15.109,4Zm0,1.2H14.5V8.6a1.823,1.823,0,0,0,1.828,1.8h3.453v7.8a.6.6,0,0,1-.609.6H9.828a.6.6,0,0,1-.609-.6V5.8A.6.6,0,0,1,9.828,5.2Zm5.891.848L18.92,9.2H16.328a.6.6,0,0,1-.609-.6Z" transform="translate(-8 -4)" fill="#747474"/>\n          </svg>',website_url:'\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">\n                <path id="Path_1213" data-name="Path 1213" d="M15.833,4a4.163,4.163,0,0,0-2.958,1.229l-.979.979a4.168,4.168,0,0,0-1.229,2.958,4.1,4.1,0,0,0,.292,1.521L12.042,9.6a2.857,2.857,0,0,1,.792-2.458l.979-.979a2.853,2.853,0,0,1,2.021-.833,2.805,2.805,0,0,1,2,.833,2.85,2.85,0,0,1,0,4.021l-.979.979A2.853,2.853,0,0,1,14.833,12a2.439,2.439,0,0,1-.437-.042l-1.083,1.083a4.1,4.1,0,0,0,1.521.292A4.163,4.163,0,0,0,17.792,12.1l.979-.979A4.168,4.168,0,0,0,20,8.167,4.2,4.2,0,0,0,15.833,4ZM14.188,8.854,8.854,14.188l.958.958,5.333-5.333ZM9.167,10.667A4.163,4.163,0,0,0,6.208,11.9l-.979.979A4.168,4.168,0,0,0,4,15.833,4.2,4.2,0,0,0,8.167,20a4.163,4.163,0,0,0,2.958-1.229l.979-.979a4.168,4.168,0,0,0,1.229-2.958,4.1,4.1,0,0,0-.292-1.521L11.958,14.4a2.857,2.857,0,0,1-.792,2.458l-.979.979a2.853,2.853,0,0,1-2.021.833,2.805,2.805,0,0,1-2-.833,2.85,2.85,0,0,1,0-4.021l.979-.979A2.853,2.853,0,0,1,9.167,12a2.44,2.44,0,0,1,.438.042l1.083-1.083A4.1,4.1,0,0,0,9.167,10.667Z" transform="translate(-4 -4)" fill="#747474"/>\n            </svg>'};class ${constructor(e){this.iconsList=e,this.themeManager=new S,this.container=document.createElement("div"),this.toggleSideBar(),this.init()}init(){if("block"===this.container.style.display)return void console.log("Content Section is already initialized");console.log("Hello wolrldl"),this.container.classList.add("sidebar-section","content-page-section"),this.container.id="content-page-section",this.container.style.display="block";const e=new A,t=new x(this.iconsList),n=this.themeManager.currentTheme.ThemeCtaColors,i=new C(n);this.createCTAComponent=new L,e.render(this.container),t.render(this.container),i.render(this.container),this.renderCreateCTAButton(),this.render()}renderCreateCTAButton(){const e=document.createElement("button");e.textContent="Add CTA",e.classList.add("tb-btn"),e.id="add-cta-button",e.addEventListener("click",(e=>{var t;e.preventDefault(),null===(t=this.createCTAComponent)||void 0===t||t.showPopup()})),this.container.append(e)}toggleSideBar(){const e=document.getElementById("menu-page-section");e&&(e.style.display="none")}render(){const e=document.getElementById("pages-content");if(e){const t=e.querySelector("#content-page-section");t&&e.removeChild(t),e.appendChild(this.container)}}}class N{constructor(e,t){this.e=e,this.editor=t}activateEditor(){const e=this.e.target.closest("#activate-editor");if(e){const t=e.closest(".content-page-block"),n=e.closest(".tb-toolbar");if(t&&n){const e=this.editor.Components.getWrapper().find("#"+n.id);e&&e.setStyle({display:"block"})}}}}class k{constructor(e){this.data=e,this.themeManager=new S}generateCta(e){if("Image"===e.CtaButtonType)return`<div id="${e.CtaId}" data-gjs-type="cta-buttons"\n                ${g} \n                  button-type="${e.CtaType}"\n                  class="img-button-container">\n                    <div ${p} class="img-button"\n                        style="background-color: ${this.themeManager.getThemeCtaColor(e.CtaBGColor)}">\n                        <span ${p} class="img-button-icon">\n                          ${this.ctaIcon(e)}\n                        </span>\n                        <div${p} class="cta-badge">\n                            <i ${p} class="fa fa-minus"></i>\n                        </div>\n                        <span ${p} class="img-button-label">${e.CtaLabel}</span>\n                        <i ${p} class="fa fa-angle-right img-button-arrow"></i>\n                    </div>\n                </div>`;if("FullWidth"===e.CtaButtonType)return`\n            <div\n                id="${e.CtaId}"\n                ${g} \n                data-gjs-type="cta-buttons"\n                button-type="${e.CtaType}"\n                class="plain-button-container"\n            >\n                <button ${p} id="ibob6" data-gjs-type="default" class="plain-button cta-styled-btn"\n                  style="background-color: ${this.themeManager.getThemeCtaColor(e.CtaBGColor)}">\n                    <div ${p} id="iyocy" data-gjs-type="default" class="cta-badge">\n                        <i ${p} id="ifxn6" data-gjs-type="default" class="fa fa-minus"></i>\n                    </div>\n                    Form\n                </button>\n            </div>\n            `;if("Icon"===e.CtaButtonType);else if("Round"===e.CtaButtonType)return`\n            <div ${g} \n              data-gjs-type="cta-buttons" \n              button-type="${e.CtaType}" \n              class="cta-container-child cta-child"\n              id="${e.CtaId}">              \n                <div class="cta-button cta-styled-btn" ${p}\n                  style="background-color: ${this.themeManager.getThemeCtaColor(e.CtaBGColor)}">\n                    ${this.ctaIcon(e)}\n                    <div class="cta-badge" ${p}><i ${p} data-gjs-type="default" class="fa fa-minus"></i></div>\n                </div>\n                <div class="cta-label" ${p}>${e.CtaLabel}</div>\n            </div>\n            `}ctaIcon(e){let t;switch(console.log(e),e.CtaType){case"Phone":t=`\n        <svg ${p} id="ixdtl" data-gjs-type="svg" xmlns="http://www.w3.org/2000/svg" width="32" height="32"\n                    viewBox="0 0 49.417 49.418">\n            <path ${p} id="call" data-gjs-type="svg-in"\n                d="M29.782,3a2.149,2.149,0,1,0,0,4.3A19.3,19.3,0,0,1,49.119,26.634a2.149,2.149,0,1,0,4.3,0A23.667,23.667,0,0,0,29.782,3ZM12.032,7.305a2.548,2.548,0,0,0-.818.067,8.342,8.342,0,0,0-3.9,2.342C2.775,14.254.366,21.907,17.437,38.98S42.16,53.643,46.7,49.1a8.348,8.348,0,0,0,2.346-3.907,2.524,2.524,0,0,0-1.179-2.786c-2.424-1.418-7.654-4.484-10.08-5.9a2.523,2.523,0,0,0-2.568.012l-4.012,2.392a2.517,2.517,0,0,1-2.845-.168,65.811,65.811,0,0,1-5.711-4.981,65.07,65.07,0,0,1-4.981-5.711A2.512,2.512,0,0,1,17.5,25.2L19.9,21.191a2.533,2.533,0,0,0,.008-2.577L14.012,8.556A2.543,2.543,0,0,0,12.032,7.305Zm17.751,4.289a2.149,2.149,0,1,0,0,4.3A10.709,10.709,0,0,1,40.525,26.634a2.149,2.149,0,1,0,4.3,0A15.072,15.072,0,0,0,29.782,11.594Zm0,8.594a2.149,2.149,0,1,0,0,4.3,2.114,2.114,0,0,1,2.149,2.148,2.149,2.149,0,1,0,4.3,0A6.479,6.479,0,0,0,29.782,20.188Z"\n                transform="translate(-4 -3)" fill="#fff"></path>\n        </svg>\n        `;break;case"Email":t=`\n        <svg ${p} id="inavf" data-gjs-type="svg" xmlns="http://www.w3.org/2000/svg" width="32"\n            height="28" viewBox="0 0 41 32.8">\n            <path ${p} id="Path_1218" data-gjs-type="svg-in" data-name="Path 1218"\n                d="M6.1,4A4.068,4.068,0,0,0,2.789,5.7a1.5,1.5,0,0,0,.444,2.126l18,11.219a2.387,2.387,0,0,0,2.531,0L41.691,7.732a1.5,1.5,0,0,0,.384-2.2A4.063,4.063,0,0,0,38.9,4Zm35.907,8.376a.963.963,0,0,0-.508.152L23.765,23.711a2.392,2.392,0,0,1-2.531,0L3.5,12.656a.98.98,0,0,0-1.5.833V32.7a4.1,4.1,0,0,0,4.1,4.1H38.9A4.1,4.1,0,0,0,43,32.7V13.357A.981.981,0,0,0,42.007,12.376Z"\n                transform="translate(-2 -4)" fill="#fff"></path>\n        </svg>\n        `;break;case"SiteUrl":t=`\n        <svg ${p} xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16">\n          <path${p} id="Path_1213" data-name="Path 1213" d="M15.833,4a4.163,4.163,0,0,0-2.958,1.229l-.979.979a4.168,4.168,0,0,0-1.229,2.958,4.1,4.1,0,0,0,.292,1.521L12.042,9.6a2.857,2.857,0,0,1,.792-2.458l.979-.979a2.853,2.853,0,0,1,2.021-.833,2.805,2.805,0,0,1,2,.833,2.85,2.85,0,0,1,0,4.021l-.979.979A2.853,2.853,0,0,1,14.833,12a2.439,2.439,0,0,1-.437-.042l-1.083,1.083a4.1,4.1,0,0,0,1.521.292A4.163,4.163,0,0,0,17.792,12.1l.979-.979A4.168,4.168,0,0,0,20,8.167,4.2,4.2,0,0,0,15.833,4ZM14.188,8.854,8.854,14.188l.958.958,5.333-5.333ZM9.167,10.667A4.163,4.163,0,0,0,6.208,11.9l-.979.979A4.168,4.168,0,0,0,4,15.833,4.2,4.2,0,0,0,8.167,20a4.163,4.163,0,0,0,2.958-1.229l.979-.979a4.168,4.168,0,0,0,1.229-2.958,4.1,4.1,0,0,0-.292-1.521L11.958,14.4a2.857,2.857,0,0,1-.792,2.458l-.979.979a2.853,2.853,0,0,1-2.021.833,2.805,2.805,0,0,1-2-.833,2.85,2.85,0,0,1,0-4.021l.979-.979A2.853,2.853,0,0,1,9.167,12a2.44,2.44,0,0,1,.438.042l1.083-1.083A4.1,4.1,0,0,0,9.167,10.667Z" transform="translate(-4 -4)" fill="#fff"></path>\n        </svg>\n        `;break;case"Form":t=`\n        <svg ${p} id="igqdh" data-gjs-type="svg" xmlns="http://www.w3.org/2000/svg" width="26" height="30"\n              viewBox="0 0 13 16">\n              <path ${p} id="Path_1209" data-gjs-type="svg-in" data-name="Path 1209"\n                  d="M9.828,4A1.823,1.823,0,0,0,8,5.8V18.2A1.823,1.823,0,0,0,9.828,20h9.344A1.823,1.823,0,0,0,21,18.2V9.8a.6.6,0,0,0-.179-.424l-.006-.006L15.54,4.176A.614.614,0,0,0,15.109,4Zm0,1.2H14.5V8.6a1.823,1.823,0,0,0,1.828,1.8h3.453v7.8a.6.6,0,0,1-.609.6H9.828a.6.6,0,0,1-.609-.6V5.8A.6.6,0,0,1,9.828,5.2Zm5.891.848L18.92,9.2H16.328a.6.6,0,0,1-.609-.6Z"\n                  transform="translate(-8 -4)" fill="#fff"></path>\n          </svg>\n        `}return t}generateContent(e){return"Image"===e.ContentType&&""!==e.ContentValue?`\n            <img ${m} id="${null==e?void 0:e.ContentId}" data-gjs-type="product-service-image" draggable="true" src="${null==e?void 0:e.ContentValue}" alt="Product Service Image" class="content-page-block">\n            `:"Description"===e.ContentType&&""!==e.ContentValue?`\n            ${this.getToolbar()}\n            <div ${m} id="${null==e?void 0:e.ContentId}" data-gjs-type="product-service-description" draggable="true" class="content-page-block">\n              <span ${p} class="edit-icon" id="activate-editor"></span>\n              ${this.addGrapesAttributes(null==e?void 0:e.ContentValue)}\n            </div>\n            `:""}generateHTML(){var e,t,n,i;let a="",o="";return(null===(t=null===(e=this.data)||void 0===e?void 0:e.PageContentStructure)||void 0===t?void 0:t.Content)&&Array.isArray(this.data.PageContentStructure.Content)&&(a=this.data.PageContentStructure.Content.map((e=>this.generateContent(e))).join("")),(null===(i=null===(n=this.data)||void 0===n?void 0:n.PageContentStructure)||void 0===i?void 0:i.Cta)&&Array.isArray(this.data.PageContentStructure.Cta)&&(o=this.data.PageContentStructure.Cta.map((e=>this.generateCta(e))).join("")),`\n            <div ${p} id="frame-container" data-gjs-type="template-wrapper" class="content-frame-container">\n                <div ${p} class="container-column">\n                    <div ${p} class="container-row">\n                        <div ${p} data-gjs-type="default" class="template-wrapper">\n                            <div \n    data-gjs-type="template-wrapper"\n    data-gjs-draggable="false"\n    data-gjs-selectable="false"\n    data-gjs-editable="false"\n    data-gjs-highlightable="true"\n    data-gjs-droppable="[data-gjs-type='product-service-description'], [data-gjs-type='product-service-image']"\n data-gjs-type="default" class="content-page-wrapper">\n                                ${a}\n                            </div>\n                        </div>\n                    </div> \n                    ${o?`\n                      <div ${v} class="cta-button-container" style="gap: 0.2rem;">\n                          ${o}\n                      </div>`:`\n                      <div ${v} class="cta-button-container" style="gap: 0.2rem;"></div>`}         \n                      <i class="fa fa-pencil></i>\n                </div>\n            </div>\n        `}addGrapesAttributes(e){const t=document.createElement("div");return"string"==typeof e&&(t.innerHTML=e),t.querySelectorAll("*").forEach((e=>{e.setAttribute("data-gjs-draggable","false"),e.setAttribute("data-gjs-selectable","false"),e.setAttribute("data-gjs-editable","false"),e.setAttribute("data-gjs-highlightable","false"),e.setAttribute("data-gjs-droppable","false"),e.setAttribute("data-gjs-resizable","false"),e.setAttribute("data-gjs-hoverable","false")})),t.innerHTML}getToolbar(){return'\n      <div class="tb-toolbar">\n        <button>B</button>\n        <button>I</button>\n        <button>U</button>\n        <button>UL</button>\n        <button>OL</button>\n        <button></button>\n      </div>\n    '}}class j{constructor(e){this.data=e,this.themeManager=new S}generateTile(e,t,n){return`\n      <div ${t?'\n    data-gjs-draggable="false"\n    data-gjs-selectable="false"\n    data-gjs-editable="false"\n    data-gjs-highlightable="false"\n    data-gjs-droppable="false"\n    data-gjs-resizable="false"\n    data-gjs-hoverable="false"\n    data-gjs-type="tile-wrapper"\n':h} class="template-wrapper" id="${e.Id}">\n        <div ${d} class="template-block${t?" first-tile high-priority-template":""}" \n          style="background-color: ${this.themeManager.getThemeColor(e.BGColor)}; color: ${e.Color}; text-align: ${e.Align};\n          ${n?"align-items: center; justify-content: center;":""}; \n          ${e.BGImageUrl?`background-image: url('${e.BGImageUrl}');\n          background-size: cover;\n          background-position: center;\n          background-blend-mode: overlay;`:""}">\n          \n          <div ${p} class="tile-icon-section">\n            <span ${p} class="tile-close-icon top-right"></span>\n            <span ${p} title="${e.Icon}" class="tile-icon">${e.Icon}</span>\n          </div>\n          \n          <div ${p} class="tile-title-section" style="${n?"text-align: center;":"text-align: left"}">\n            <span ${p} class="tile-close-icon top-right"></span>\n            <span ${p} class="tile-title" title="${e.Text}">${e.Text}</span>\n          </div>\n        </div>\n        ${t?"":`\n          <button ${p} title="Delete tile" class="action-button delete-button"></button>`}\n        <button ${p} title="Add tile right" class="action-button add-button-right">+</button>\n        <button ${p} title="Add tile below" class="action-button add-button-bottom">+</button>\n      </div>\n    `}generateRow(e,t){const n=0===t&&1===e.Tiles.length,i=3===e.Tiles.length,a=e.Tiles.map(((e,t)=>this.generateTile(e,n&&0===t,i))).join("");return`<div id="${e.Id}" ${u} class="container-row">${a}</div>`}generateHTML(){const e=`\n      <div ${p} id="frame-container" data-gjs-type="template-wrapper" class="frame-container">\n        <div ${p} class="container-column">\n          ${this.data.PageMenuStructure.Rows.map(((e,t)=>this.generateRow(e,t))).join("")}\n        </div>\n      </div>\n    `;return this.filterHTML(e)}filterHTML(e){const t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll(".container-row").forEach((e=>{3===e.querySelectorAll(".template-block").length&&e.querySelectorAll(".add-button-right").forEach((e=>{e.style.display="none"}))})),t.innerHTML}}class D{constructor(e){this.editor=e}load(){this.editor.setComponents(this.htmlData())}htmlData(){return`\n            <div class="tb-date-selector" ${p}>\n                <span class="tb-arrow"  ${p}></span>\n                <span class="tb-date-text" id="current-date"  ${p}> ${this.formatDate()}</span>\n                <span class="tb-arrow"  ${p}></span>\n            </div>\n\n            <div class="tb-schedule" id="schedule-container" ${p}>\n            <div class="tb-time-slot" ${p}>\n                <div class="tb-time" ${p}>6:00</div>\n                <div class="tb-events" ${p}></div>\n            </div>\n            <div class="tb-time-slot" ${p}>\n                <div class="tb-time" ${p}>7:00</div>\n                <div class="tb-events" ${p}></div>\n            </div>\n            <div class="tb-time-slot" ${p}>\n                <div class="tb-time" ${p}>8:00</div>\n                <div class="tb-events" ${p}></div>\n                <div class="tb-current-time-indicator" ${p}></div>\n                <div class="tb-current-time-dot" ${p}></div>\n            </div>\n            <div class="tb-time-slot" ${p}>\n                <div class="tb-time" ${p}>9:00</div>\n                <div class="tb-events" ${p}></div>\n            </div>\n            <div class="tb-time-slot" ${p}>\n                <div class="tb-time" ${p}>10:00</div>\n                <div class="tb-events" ${p}></div>\n            </div>\n            <div class="tb-time-slot" ${p}>\n                <div class="tb-time" ${p}>11:00</div>\n                <div class="tb-events" ${p}></div>\n            </div>\n            <div class="tb-time-slot" ${p}>\n                <div class="tb-time" ${p}>12:00</div>\n                <div class="tb-events" ${p}></div>\n            </div>\n            <div class="tb-time-slot" ${p}>\n                <div class="tb-time" ${p}>13:00</div>\n                <div class="tb-events" ${p}></div>\n            </div>\n            <div class="tb-time-slot" ${p}>\n                <div class="tb-time" ${p}>14:00</div>\n                <div class="tb-events" ${p}></div>\n            </div>\n         `}formatDate(){return(new Date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/(\d{2} \w{3}) (\d{4})/,"$1, $2")}}class B{constructor(e){this.editor=e}load(){this.editor.setComponents(this.htmlData())}htmlData(){return`\n         <div class="tb-chat-container" ${p}>\n            <div class="tb-toggle-buttons"  ${p}>\n                <button style="background-color: #5068a8;border-radius: 6px;"  ${p}>Messages</button>\n                <button style="background-color: #e1e1e1;border-radius: 6px;color: #262626;"  ${p}>Requests</button>\n            </div>\n            <div class="tb-chat-body" ${p}>No messages yet</div>\n        </div>\n         `}}class O{constructor(e){this.editor=e}initialise(e){return t=this,n=void 0,a=function*(){const t=null==e?void 0:e.ObjectUrl;try{this.editor.DomComponents.clear(),this.editor.DomComponents.addType("object",{isComponent:e=>"OBJECT"===e.tagName,model:{defaults:{tagName:"object",draggable:!0,droppable:!1,attributes:{width:"100%",height:"300vh"},styles:"\n                  .form-frame-container {\n                    overflow-x: hidden;\n                    overflow-y: auto;\n                    position: relative;\n                    min-height: 300px;\n                  }\n      \n                  /* Preloader styles */\n                  .preloader-wrapper {\n                    position: absolute;\n                    top: 50%;\n                    left: 50%;\n                    transform: translate(-50%, -50%);\n                    z-index: 1000;\n                  }\n      \n                  .preloader {\n                    width: 32px;\n                    height: 32px;\n                    background-image: url('/Resources/UCGrapes1/src/images/spinner.gif');\n                    background-size: contain;\n                    background-repeat: no-repeat;\n                  }\n      \n                  /* Custom scrollbar styles */\n                  .form-frame-container::-webkit-scrollbar {\n                    width: 6px;\n                    height: 0;\n                  }\n      \n                  .form-frame-container::-webkit-scrollbar-track {\n                    background: #f1f1f1;\n                    border-radius: 3px;\n                  }\n      \n                  .form-frame-container::-webkit-scrollbar-thumb {\n                    background: #888;\n                    border-radius: 3px;\n                  }\n      \n                  .form-frame-container::-webkit-scrollbar-thumb:hover {\n                    background: #555;\n                  }\n      \n                  /* Firefox scrollbar styles */\n                  .form-frame-container {\n                    scrollbar-width: thin;\n                    scrollbar-color: #888 #f1f1f1;\n                  }\n                  .fallback-message {\n                    margin-bottom: 10px;\n                    color: #666;\n                  }\n                "}},view:{onRender({el:e,model:t}){const n=`\n                  <div class="fallback-content">\n                    <p class="fallback-message">${t.get("attributes").fallbackMessage||"Content cannot be displayed"}</p>\n                    <a href="${t.get("attributes").data}" \n                       target="_blank" \n                       class="fallback-link">\n                      Open in New Window\n                    </a>\n                  </div>\n                `;e.insertAdjacentHTML("beforeend",n),e.addEventListener("load",(()=>{const t=e.closest(".form-frame-container").querySelector(".preloader-wrapper");t&&(t.style.display="none"),e.querySelector(".fallback-content").style.display="none",console.log("Object content loaded")})),e.addEventListener("error",(t=>{const n=e.closest(".form-frame-container").querySelector(".preloader-wrapper");n&&(n.style.display="none");const i=e.querySelector(".fallback-content");i&&(i.style.display="flex",i.style.flexDirection="column",i.style.justifyContent="start")}))}}}),this.editor.setComponents(`\n            <div class="form-frame-container" id="frame-container">\n              <div class="preloader-wrapper">\n                <div class="preloader"></div>\n              </div>\n              <object \n                data="${t}"\n                type="text/html"\n                width="100%"\n                height="800px"\n                fallbackMessage="Unable to load the content. Please try opening it in a new window.">\n              </object>\n            </div>\n          `)}catch(e){console.error("Error setting up object component:",e.message)}},new((i=void 0)||(i=Promise))((function(e,o){function s(e){try{r(a.next(e))}catch(e){o(e)}}function l(e){try{r(a.throw(e))}catch(e){o(e)}}function r(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,l)}r((a=a.apply(t,n||[])).next())}));var t,n,i,a}}class V{constructor(e,t){this.pageId=e,this.pageData=t,this.themeManager=new S,this.editorManager=new Y,this.editorEvents=new R}init(e){var t,n,i,a,o,s;let l=`gjs-${this.getEditorId()}`;this.pageTitle=e.Text,this.createNewEditor(l);const r=this.editorManager.initializeGrapesEditor(l),c=e=>{if(e){const t=e.generateHTML();r.setComponents(t),localStorage.setItem(`data-${this.pageId}`,JSON.stringify(this.pageData))}else console.error("Invalid PageType or pageData is undefined:",this.pageData)};let d;"Menu"===(null===(t=this.pageData)||void 0===t?void 0:t.PageType)?(d=new j(this.pageData),c(d)):"Content"===(null===(n=this.pageData)||void 0===n?void 0:n.PageType)?(d=new k(this.pageData),c(d)):"WebLink"===(null===(i=this.pageData)||void 0===i?void 0:i.PageType)||"DynamicForm"===(null===(a=this.pageData)||void 0===a?void 0:a.PageType)?new O(r).initialise(e.Action):"MyActivity"===(null===(o=this.pageData)||void 0===o?void 0:o.PageType)?new B(r).load():"Calendar"===(null===(s=this.pageData)||void 0===s?void 0:s.PageType)&&new D(r).load(),this.editorEvents.init(r,this.pageData,l),this.editorManager.finalizeEditorSetup(r),this.themeManager.applyTheme(this.themeManager.currentTheme)}createNewEditor(e){const t=document.getElementById("child-container");new z(e,!1,this.pageTitle).render(t)}getEditorId(){let e=0;return document.querySelectorAll(".mobile-frame").forEach((t=>{e++})),e}addImageContent(e){const t=e.DomComponents.getWrapper().find(".content-page-wrapper");t.length>0&&t[0].append(`\n      <img ${m} id="${f(5)}" data-gjs-type="product-service-image" draggable="true" src="https://plus.unsplash.com/premium_photo-1686949554005-78d1370ab4f3?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxmZWF0dXJlZC1waG90b3MtZmVlZHw2fHx8ZW58MHx8fHx8" alt="Product Service Image" class="content-page-block">\n      `)}addDescriptionContent(e){const t=e.DomComponents.getWrapper().find(".content-page-wrapper");t.length>0&&t[0].append(`\n      <div ${m} id="${f(5)}" data-gjs-type="product-service-description" draggable="true" class="content-page-block">\n          lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua\n      </div>\n      `)}}class F{constructor(e,t){this.selectedComponent=e,this.ctaAttributes=t,this.themeManager=new S}setctaAttributes(){this.ctaColorAttributes()}ctaColorAttributes(){const e=document.querySelector("#content-page-section");console.log("this.contentSection",e);const t=null==e?void 0:e.querySelectorAll(".color-item > input");let n=this.themeManager.getThemeCtaColor(this.ctaAttributes.CtaBGColor);null==t||t.forEach((e=>{console.log("ctaColorAttribute",n),console.log("input",e),e.value===n&&(e.checked=!0)}))}}class _{constructor(e){this.pageId=e}addFreshRow(e,t){var n,i;const a=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}"),o={Id:e,Tiles:[{Id:t,Name:"Title",Text:"Title",Color:"#333333",Align:"left",Icon:"home",BGColor:"transparent",BGImageUrl:"",Opacity:"0",Action:{ObjectType:"",ObjectId:"",ObjectUrl:""},TilePermissionName:""}]};null===(i=null===(n=a.PageMenuStructure)||void 0===n?void 0:n.Rows)||void 0===i||i.push(o),localStorage.setItem(`data-${this.pageId}`,JSON.stringify(a))}addTile(e,t){var n,i;const a={Id:t,Name:"Title",Text:"Title",Color:"#333333",Align:"left",Icon:"home",BGColor:"transparent",BGImageUrl:"",Opacity:"0",Action:{ObjectType:"",ObjectId:"",ObjectUrl:""},TilePermissionName:""},o=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}"),s=null===(i=null===(n=o.PageMenuStructure)||void 0===n?void 0:n.Rows)||void 0===i?void 0:i.find((t=>t.Id===e));s&&(s.Tiles.push(a),localStorage.setItem(`data-${this.pageId}`,JSON.stringify(o)))}removeTile(e,t){var n,i;const a=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}"),o=a.PageMenuStructure.Rows.find((e=>String(e.Id)===String(t)));o&&(o.Tiles=o.Tiles.filter((t=>t.Id!==e)),0===o.Tiles.length&&(a.PageMenuStructure.Rows=null===(i=null===(n=a.PageMenuStructure)||void 0===n?void 0:n.Rows)||void 0===i?void 0:i.filter((e=>e.Id!==o.Id))),localStorage.setItem(`data-${this.pageId}`,JSON.stringify(a)))}updateTile(e,t,n){var i,a;const o=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}");null===(a=null===(i=null==o?void 0:o.PageMenuStructure)||void 0===i?void 0:i.Rows)||void 0===a||a.forEach((i=>{i.Tiles.forEach((i=>{if(i.Id===e)if(t.includes(".")){const e=t.split(".");let a=i;for(let t=0;t<e.length-1;t++)a=a[e[t]];a[e[e.length-1]]=n}else i[t]=n}))})),localStorage.setItem(`data-${this.pageId}`,JSON.stringify(o))}getTile(e,t){var n,i;const a=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}");if(e){const o=null===(i=null===(n=null==a?void 0:a.PageMenuStructure)||void 0===n?void 0:n.Rows)||void 0===i?void 0:i.find((t=>t.Id===e));if(o)return o.Tiles.find((e=>e.Id===t))||null}return null}findPageByTileId(e,t){var n;for(const i of e)for(const e of null===(n=null==i?void 0:i.PageMenuStructure)||void 0===n?void 0:n.Rows)for(const n of e.Tiles)if(n.Id===t)return i.PageId;return null}moveTile(e,t,n,i){var a,o,s,l,r,c,d,h;const p=JSON.parse(localStorage.getItem(`data-${this.pageId}`)||"{}"),u=null===(a=null==p?void 0:p.PageMenuStructure)||void 0===a?void 0:a.Rows.find((e=>e.Id===t));if(!u)return;const m=null===(o=null==u?void 0:u.Tiles)||void 0===o?void 0:o.findIndex((t=>t.Id===e));if(-1===m)return;const[g]=null===(s=null==u?void 0:u.Tiles)||void 0===s?void 0:s.splice(m,1),v=null===(r=null===(l=p.PageMenuStructure)||void 0===l?void 0:l.Rows)||void 0===r?void 0:r.find((e=>e.Id===n));v?(v.Tiles.splice(i,0,g),3===(null===(c=null==v?void 0:v.Tiles)||void 0===c?void 0:c.length)&&(null==v||v.Tiles.forEach((e=>{e.Align="center"}))),0===(null===(d=null==u?void 0:u.Tiles)||void 0===d?void 0:d.length)&&(p.PageMenuStructure.Rows=null===(h=null==p?void 0:p.PageMenuStructure)||void 0===h?void 0:h.Rows.filter((e=>e.Id!==u.Id))),localStorage.setItem(`data-${this.pageId}`,JSON.stringify(p))):u.Tiles.splice(m,0,g)}}class H{constructor(e){this.pageId=e||null}updateTile(e,t=!1){this.rowComponent=e;const n=e.components();console.log(n);const i=n.length;n.forEach((e=>{const n=e.find(".add-button-right")[0];n&&n.addStyle({display:i>=3?"none":"flex"});const a={"justify-content":3===i?"center":"start","align-items":3===i?"center":"start"},o={"text-align":3===i?"center":"left"};this.updateTileHeight(e,i),this.updateAlignment(e,a,o),this.updateTileTitleLength(e,i),t||this.updateTileAttributes(e.getId(),"Align",a["justify-content"])}))}updateTileHeight(e,t){const n=e.find(".template-block")[0];1===t?n.getClasses().includes("first-tile")&&n.addClass("high-priority-template"):n.removeClass("high-priority-template")}updateAlignment(e,t,n){const i=e.find(".template-block")[0],a=e.find(".tile-title-section")[0];i.addStyle(t),a.addStyle(n)}updateTileTitleLength(e,t){var n;const i=e.find(".tile-title")[0];if(i){const e=3===t?11:2===t?15:20,a=this.truncateText(e,(null===(n=i.getAttributes())||void 0===n?void 0:n.title)||i.getEl().innerText);3===t?i.components(this.wrapTileTitle(a)):i.components(a)}}truncateText(e,t){const n=window.innerWidth;return t.length>(n<=1440?e:e+4)?t.substring(0,n<=1440?e:e+4).trim()+"..":t}wrapTileTitle(e){const t=e.split(" ");return t.length>1?t[0]+"<br>"+t[1]:e.replace("<br>","")}updateTileAttributes(e,t,n){console.log(e,t,n);let i=n;"start"===n&&(i="left"),new _(this.pageId).updateTile(e,t,i)}}class q{constructor(e,t,n,i){this.event=e,this.editor=t,this.pageId=n,this.frameId=i,this.tileUpdate=new H(n),globalThis.tileMapper=new _(this.pageId),this.init()}init(){this.addTileBottom(),this.addTileRight(),this.deleteTile(),this.removeTileIcon(),this.removeTileTile(),this.removeCTa()}addTileBottom(){var e;const t=this.event.target.closest(".action-button.add-button-bottom");if(t){const n=t.closest(".template-wrapper");if(!n)return;let i=n.parentElement,a=null==i?void 0:i.parentElement;if(!i||!a)return;const o=Array.from(a.children).indexOf(i),s=this.editor.Components.getWrapper().find("#"+a.id)[0];if(!s)return;const l=this.editor.Components.addComponent(this.getTileRow());s.append(l,{at:o+1});const r=null===(e=l.find(".template-wrapper")[0])||void 0===e?void 0:e.getId();globalThis.tileMapper.addFreshRow(l.getId(),r)}}addTileRight(){var e;const t=this.event.target.closest(".action-button.add-button-right");if(t){const n=t.closest(".template-wrapper"),i=this.editor.Components.getWrapper().find("#"+(null==n?void 0:n.id))[0];if(!i)return;const a=i.parent();if(a.components().filter((e=>"tile-wrapper"===e.get("type"))).length>=3)return;const o=this.editor.Components.addComponent(this.getTile()),s=i.index();a.append(o,{at:s+1}),globalThis.tileMapper.addTile(null===(e=null==n?void 0:n.parentElement)||void 0===e?void 0:e.id,o.getId()),this.tileUpdate.updateTile(a)}}deleteTile(){const e=this.event.target.closest(".action-button.delete-button");if(e){const t=e.closest(".template-wrapper");if(t){const e=this.editor.Components.getWrapper().find("#"+(null==t?void 0:t.id))[0],n=e.parent();e.remove(),this.tileUpdate.updateTile(n),globalThis.tileMapper.removeTile(e.getId(),n.getId()),this.removeEditor(e.getId())}}}removeTileIcon(){const e=this.event.target.closest(".tile-close-icon");if(e){const t=e.parentElement,n=this.editor.Components.getWrapper().find("#"+(null==t?void 0:t.id))[0];this.checkTileHasIconOrTitle(n)?n.addStyle({display:"none"}):console.warn("Tile has no icon or title")}}removeTileTile(){const e=this.event.target.closest(".tile-close-title");if(e){const t=e.parentElement,n=this.editor.Components.getWrapper().find("#"+(null==t?void 0:t.id))[0];this.checkTileHasIconOrTitle(n)?n.addStyle({display:"none"}):console.warn("Tile has no icon or title")}}checkTileHasIconOrTitle(e){const t=e.parent();if(!t)return!1;const n=t.components(),i=n.some((e=>{var t;const n=null===(t=e.getStyle())||void 0===t?void 0:t.display;return e.getClasses().includes("tile-title-section")&&"none"!==n&&void 0!==n})),a=n.some((e=>{var t;const n=null===(t=e.getStyle())||void 0===t?void 0:t.display;return e.getClasses().includes("tile-icon-section")&&"none"!==n&&void 0!==n}));return i&&a}removeCTa(){const e=this.event.target.closest(".cta-badge");e&&(new y).removeCta(e)}removeEditor(e){document.querySelectorAll(".mobile-frame").forEach((t=>{const n=t.querySelector(`#${e}`);if(n&&console.log(n),t.id.includes(this.frameId)){let e=t.nextElementSibling;for(;e;){const t=e;e=e.nextElementSibling,t&&(t.remove(),(new R).activateNavigators())}}}))}getTileRow(){const e=this.getTile();return`<div class="container-row" ${u} id="${f(8)}">${e}</div>`}getTile(){return`\n      <div ${h} class="template-wrapper" id="${f(8)}">\n        <div ${d} class="template-block" style="background-color: transparent; color: #333333; justify-content: left">\n            <div ${p} id="igtdq" data-gjs-type="default" class="tile-icon-section">\n              <span ${p} id="is1dw" data-gjs-type="text" class="tile-close-icon top-right selected-tile-title"></span>\n              <span ${p} id="ic26t" data-gjs-type="text" class="tile-icon">Title</span>\n            </div>\n            <div ${p} id="igtdq" data-gjs-type="default" class="tile-title-section">\n              <span ${p} id="is1dw" data-gjs-type="text" class="tile-close-icon top-right selected-tile-title"></span>\n              <span ${p} style="display: block" id="ic26t" data-gjs-type="text" is-hidden="false" title="Title" class="tile-title">Title</span>\n            </div>\n        </div>\n        <button ${p} id="i9sxl" data-gjs-type="default" title="Delete template" class="action-button delete-button">&minus;</button>\n        <button ${p} id="ifvvi" data-gjs-type="default" title="Add template right" class="action-button add-button-right">+</button>\n        <button ${p} id="i4ubt" data-gjs-type="default" title="Delete template" class="action-button add-button-bottom">&plus;</button>\n      </div>\n    `}}class U{constructor(e,t){this.tileAttributes=t,this.selectedComponent=e,this.themeManager=new S}setTileAttributes(){this.setBgColorProperties(),this.setOpacityProperties(),this.setTitleStyleProperties(),this.setTileActionProperties(),this.setActionProperties()}setBgColorProperties(){var e,t;const n=document.getElementById("theme-color-palette"),i=null===(e=this.selectedComponent.getStyle())||void 0===e?void 0:e["background-color"],a=null===(t=this.selectedComponent.getStyle())||void 0===t?void 0:t["background-image"],o=this.themeManager.getThemeColor(this.tileAttributes.BGColor);a&&console.log("has bg image");const s=null==n?void 0:n.children;for(let e=0;e<s.length;e++){const t=s[e].querySelector("input");a||i!==o||i!==t.value?t.checked=!1:t.checked=!0}}setOpacityProperties(){var e;const t=this.tileAttributes.BGImageUrl,n=this.tileAttributes.Opacity,i=null===(e=this.selectedComponent.getStyle())||void 0===e?void 0:e["background-image"];let a="";if(i&&i.startsWith("url(")&&(a=i.replace(/^url\(["']?/,"").replace(/["']?\)$/,"")),a&&t){if(a===t){const e=document.querySelector(".tile-img-section");if(e){e.querySelector("#slider-wrapper").style.display="flex",e.querySelector("#bg-opacity").value=n,e.querySelector("#valueDisplay").textContent=n+"%";const i=e.querySelector("#tile-img-container");i.style.display="block";const a=i.querySelector("#tile-img-thumbnail");a&&(a.src=t),this.selectedComponent.addStyle({"background-color":`rgba(0, 0, 0, ${n/100})`})}}}else{const e=document.querySelector("#slider-wrapper"),t=document.querySelector("#tile-img-container");e.style.display="none",t.style.display="none"}}setTitleStyleProperties(){const e=document.querySelector("#tile-title"),t=this.tileAttributes.Text;e.value=t;const n=this.tileAttributes.Color,i=document.querySelector("#text-color-palette"),a=null==i?void 0:i.querySelectorAll("input");null==a||a.forEach((e=>{e.value===n?e.checked=!0:e.checked=!1}))}setTileActionProperties(){const e=this.tileAttributes.Align,t=document.querySelector(".text-alignment"),n=null==t?void 0:t.querySelectorAll("input");null==n||n.forEach((t=>{t.value===e?t.checked=!0:t.checked=!1}))}setActionProperties(){var e,t;const n=null===(e=this.tileAttributes.Action)||void 0===e?void 0:e.ObjectType,i=null===(t=this.tileAttributes)||void 0===t?void 0:t.Text,a=document.querySelector(".tb-dropdown-header").querySelector("#sidebar_select_action_label");a&&(a.innerText=n?`${n.length>10?n.substring(0,14)+"...":n}, ${i.length>10?i.substring(0,14)+"...":i}`:"Select Action")}}var Z=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class R{constructor(){this.handleComponentAdd=e=>{var t;const n=e.parent();n&&(null===(t=n.getEl())||void 0===t?void 0:t.classList.contains("container-row"))&&3===n.components().filter((e=>"tile-wrapper"===e.get("type"))).length&&console.log("more than 3")},this.appVersionManager=new T,this.toolboxService=new a}init(e,t,n){this.editor=e,this.pageData=t,this.pageId=t.PageId,this.frameId=n,this.onLoad(),this.onDragAndDrop(),this.onSelected()}onLoad(){void 0!==this.editor&&(this.editor.getWrapper().view.el.addEventListener("click",(e=>{this.tileManager=new q(e,this.editor,this.pageId,this.frameId),new N(e,this.editor).activateEditor(),globalThis.activeEditor=this.editor,globalThis.currentPageId=this.pageId,this.activateEditor()})),this.activateNavigators())}onDragAndDrop(){let e,t;const n=new _(this.pageId),i=new b(this.pageId);this.editor.on("component:drag:start",(t=>{e=t.parent})),this.editor.on("component:drag:end",(a=>{t=a.parent;const o=t.getEl();if(o&&o.classList.contains("container-row")){a.parent.components().filter((e=>"tile-wrapper"===e.get("type"))).length>3&&(a.target.remove(),this.editor.UndoManager.undo());const i=!0,o=new H;o.updateTile(t,i),o.updateTile(e,i),n.moveTile(a.target.getId(),e.getId(),t.getId(),a.index),this.onTileUpdate(t)}else o&&o.classList.contains("content-page-wrapper")?i.moveContentRow(a.target.getId(),a.index):o&&o.classList.contains("cta-button-container")&&(console.log("cta-button-container",a.target.getId()),i.moveCta(a.target.getId(),a.index))}))}onSelected(){this.editor.on("component:selected",(e=>{globalThis.selectedComponent=e,globalThis.tileMapper=new _(this.pageId),globalThis.frameId=this.frameId,this.setTileProperties(),this.setCtaProperties(),this.createChildEditor()})),this.editor.on("component:deselected",(()=>{globalThis.selectedComponent=null}))}onTileUpdate(e){var t;e&&(null===(t=e.getEl())||void 0===t?void 0:t.classList.contains("container-row"))&&(this.editor.off("component:add",this.handleComponentAdd),this.editor.on("component:add",this.handleComponentAdd))}activateEditor(){document.querySelectorAll(".mobile-frame").forEach((e=>{e.classList.remove("active-editor"),e.id.includes(this.frameId)&&(e.classList.add("active-editor"),this.toggleSidebar())}))}toggleSidebar(){return Z(this,void 0,void 0,(function*(){var e,t;if("Content"===(null===(e=this.pageData)||void 0===e?void 0:e.PageType)){const e=yield this.toolboxService.getContentPageData(null===(t=this.pageData)||void 0===t?void 0:t.PageId);e&&new $(e.SDT_ProductService.CallToActions)}else{const e=document.getElementById("menu-page-section"),t=document.getElementById("content-page-section");e&&(e.style.display="block"),t&&(t.style.display="none")}}))}setTileProperties(){const e=globalThis.selectedComponent,t=e.parent(),n=t.parent(),i=globalThis.tileMapper.getTile(n.getId(),t.getId());e&&i&&(this.tileProperties=new U(e,i),this.tileProperties.setTileAttributes())}setCtaProperties(){const e=globalThis.selectedComponent,t=new b(this.pageId).getContentCta(e.getId());t&&new F(e,t).setctaAttributes()}createChildEditor(){return Z(this,void 0,void 0,(function*(){var e;const t=globalThis.selectedComponent.parent(),n=t.parent(),i=globalThis.tileMapper.getTile(n.getId(),t.getId());if(null===(e=null==i?void 0:i.Action)||void 0===e?void 0:e.ObjectId){const e=i.Action.ObjectId,t=JSON.parse(localStorage.getItem(`data-${e}`)||"{}");let n;if(Object.keys(t).length>0)n=t;else{const t=yield this.appVersionManager.getActiveVersion();n=null==t?void 0:t.Pages.find((t=>t.PageId===e))}this.removeOtherEditors(),n&&new V(e,n).init(i)}else{this.removeOtherEditors(),this.activateNavigators();const e=new r,t=document.querySelector("#child-container");e.render(t)}}))}removeOtherEditors(){document.querySelectorAll(".mobile-frame").forEach((e=>{if(e.id.includes(this.frameId)){let t=e.nextElementSibling;for(;t;){const e=t;t=t.nextElementSibling,e&&e.remove()}}}))}activateNavigators(){const e=document.querySelector(".page-navigator-left"),t=document.querySelector(".page-navigator-right"),n=document.getElementById("child-container"),i=document.getElementById("scroll-left"),a=document.getElementById("scroll-right"),o=document.querySelectorAll(".mobile-frame");Array.from(o).reduce(((e,t)=>e+t.clientWidth),0)>n.clientWidth?(e.style.display="flex",t.style.display="flex"):(e.style.display="none",t.style.display="none");const s=window.innerWidth<=1440?o.length>1?"flex-start":"center":o.length>3?"flex-start":"center";n.style.setProperty("justify-content",s);const l=e=>{n.scrollTo({left:n.scrollLeft+e,behavior:"smooth"})};i.addEventListener("click",(()=>l(-200))),a.addEventListener("click",(()=>l(200)));const r=()=>{const{scrollLeft:e,scrollWidth:t,clientWidth:o}=n;i.style.display=e>0?"flex":"none",a.style.display=e+o<t?"flex":"none"};return r(),n.addEventListener("scroll",r),{updateButtonVisibility:r,scrollBy:l}}}class W{constructor(e,t){this.title=t||"Page Name",this.id=e,this.container=document.createElement("div"),this.editor=new Y,this.init()}init(){this.container.classList.add("app-bar");const e=document.createElement("svg");e.innerHTML='\n          <svg class="content-back-button" xmlns="http://www.w3.org/2000/svg" data-name="Group 14" width="47" height="47" viewBox="0 0 47 47">\n            <g id="Ellipse_6" data-name="Ellipse 6" fill="none" stroke="#262626" stroke-width="1">\n              <circle cx="23.5" cy="23.5" r="23.5" stroke="none"></circle>\n              <circle cx="23.5" cy="23.5" r="23" fill="none"></circle>\n            </g>\n            <path id="Icon_ionic-ios-arrow-round-up" data-name="Icon ionic-ios-arrow-round-up" d="M13.242,7.334a.919.919,0,0,1-1.294.007L7.667,3.073V19.336a.914.914,0,0,1-1.828,0V3.073L1.557,7.348A.925.925,0,0,1,.263,7.341.91.91,0,0,1,.27,6.054L6.106.26h0A1.026,1.026,0,0,1,6.394.07.872.872,0,0,1,6.746,0a.916.916,0,0,1,.64.26l5.836,5.794A.9.9,0,0,1,13.242,7.334Z" transform="translate(13 30.501) rotate(-90)" fill="#262626"></path>\n          </svg>\n        ',e.addEventListener("click",(e=>{e.preventDefault();const t=document.querySelector(`#${this.id}-frame`);if(t){let e=t.nextElementSibling;for(;e;){const t=e;e=e.nextElementSibling,t.remove()}t.remove(),(new R).activateNavigators()}}));const t=document.createElement("h1");t.className="title";const n=this.title.length>20?this.title.substring(0,16)+"...":this.title;t.setAttribute("title",n||"Page Name"),t.textContent=n||"Page Name",this.container.appendChild(e),this.container.appendChild(t)}render(e){e.appendChild(this.container)}}class z{constructor(e,t=!1,n){this.container=document.createElement("div"),this.id=e,this.isHome=t,this.pageName=n,this.init()}init(){this.container.className="mobile-frame",this.container.id=`${this.id}-frame`,this.container.setAttribute("data-pageid","1");const e=new s,t=new l,n=new W(this.id,this.pageName);e.render(this.container),this.isHome?t.render(this.container):n.render(this.container);const i=document.createElement("div");i.id=this.id,this.container.appendChild(i)}render(e){e.appendChild(this.container)}}class G{constructor(e){this.pageId=e,this.container=document.createElement("div"),this.init()}init(){this.container.style.justifyContent="center",this.container.className="frame-list",this.container.id="child-container",new z(`${this.pageId}`,!0).render(this.container)}render(e){e.appendChild(this.container)}}class J{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.style.display="none",this.container.className="navigator page-navigator-left",this.container.innerHTML='<span id="scroll-left"><i class="fa fa-arrow-left-long"></i></span>',this.container.addEventListener("click",(e=>{}))}render(e){e.appendChild(this.container)}}class K{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.style.display="none",this.container.className="navigator page-navigator-right",this.container.innerHTML='<span id="scroll-right"><i class="fa fa-arrow-right-long"></i></span>',this.container.addEventListener("click",(e=>{}))}render(e){e.appendChild(this.container)}}var X=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class Y{constructor(){this.editors=[],this.config=e.getInstance(),this.organisationLogo=this.config.organisationLogo,this.themeManager=new S,this.toolboxService=new a,this.editorEvents=new R,this.jsonToGrapes=new j(this)}init(){return X(this,void 0,void 0,(function*(){var e;const t=yield this.toolboxService.getVersions();this.homepage=null===(e=t.AppVersions.find((e=>1==e.IsActive)))||void 0===e?void 0:e.Pages.find((e=>"Home"===e.PageName)),this.setUpEditorFrame(),this.setUpEditor()}))}setUpEditorFrame(){const e=new J,t=new K,n=new G("gjs-0"),i=document.getElementById("main-content");e.render(i),n.render(i),t.render(i)}setUpEditor(){return X(this,void 0,void 0,(function*(){const e=this.initializeGrapesEditor("gjs-0");this.finalizeEditorSetup(e),yield this.loadHomePage(e),this.activateHomeEditor("gjs-0"),this.themeManager.applyTheme(this.themeManager.currentTheme)}))}loadHomePage(e){return X(this,void 0,void 0,(function*(){var t;const n=new j(this.homepage).generateHTML();e.setComponents(n),this.editorEvents.init(e,this.homepage,"gjs-0"),localStorage.setItem(`data-${null===(t=this.homepage)||void 0===t?void 0:t.PageId}`,JSON.stringify(this.homepage))}))}initializeGrapesEditor(e){return grapesjs.init({container:`#${e}`,fromElement:!0,height:"100%",width:"auto",canvas:{styles:["/Resources/UCGrapes1/src/css/toolbox.css","/DVelop/Bootstrap/Shared/fontawesome_vlatest/css/all.min.css?202521714271081","https://fonts.googleapis.com/css2?family=Inter:opsz@14..32&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"]},baseCss:" ",dragMode:"normal",panels:{defaults:[]},sidebarManager:!1,storageManager:!1,modal:!1,commands:!1,hoverable:!1,highlightable:!1,selectable:!1,richTextEditor:{}})}finalizeEditorSetup(e){e.getWrapper().set({selectable:!1,droppable:!1,draggable:!1,hoverable:!1});const t=e.Canvas.getElement();t&&t.style.setProperty("height","calc(100% - 100px)","important");const n=e.Canvas.getBody();n&&n.style.setProperty("background-color","#EFEEEC","important")}updateEditors(e,t,n){}activateHomeEditor(e){const t=document.getElementById(`${e}-frame`);null==t||t.classList.add("active-editor")}}class Q{constructor(){this.toolboxService=new a}openModal(){const e=document.createElement("div"),t=document.createElement("p");t.innerText="Are you sure you want to publish? Once published, all currently visible pages will be finalized and visible to residents. This action cannot be undone.";const n=document.createElement("label");n.className="notify_residents";const i=document.createElement("input");i.type="checkbox",i.id="notify_residents",i.name="notify_residents";const a=document.createElement("span");a.innerText="Notify residents on about the updates made.",n.appendChild(i),n.appendChild(a);const o=document.createElement("div");o.classList.add("popup-footer"),o.style.marginBottom="-12px";const s=this.createButton("submit_publish","tb-btn-primary","Publish"),l=this.createButton("cancel_publish","tb-btn-secondary","Cancel");o.appendChild(s),o.appendChild(l),e.appendChild(t),e.appendChild(n),e.appendChild(o);const r=new I({title:"Confirm Publish",width:"500px",body:e});r.open(),s.addEventListener("click",(e=>{e.preventDefault(),console.log("Publishing...",i.checked)})),l.addEventListener("click",(e=>{e.preventDefault(),r.close()}))}processData(){}createButton(e,t,n){const i=document.createElement("button");return i.id=e,i.classList.add("tb-btn",t),i.innerText=n,i}}class ee{constructor(e,t,n={}){if(this.button=document.createElement("button"),this.button.id=e,this.button.className=`tb-btn tb-btn-${n.variant||"primary"}`,n.svg){const e=(new DOMParser).parseFromString(n.svg,"image/svg+xml").documentElement;this.button.appendChild(e)}const i=document.createElement("span");n.labelId&&(i.id=n.labelId),i.textContent=t,this.button.appendChild(i)}render(e){e.appendChild(this.button)}}class te{constructor(){this.container=document.createElement("div"),this.undoButton=document.createElement("button"),this.redoButton=document.createElement("button"),this.init()}init(){this.container.classList.add("edit-actions"),this.undoButton.id="undo",this.undoButton.className="btn-transparent",this.undoButton.title="Undo (ctrl+z)",this.undoButton.innerHTML="<span class='fa fa-undo'></span>",this.undoButton.addEventListener("click",this.handleUndo),this.redoButton.id="redo",this.redoButton.className="btn-transparent",this.redoButton.title="Redo (ctrl+shift+z)",this.redoButton.innerHTML="<span class='fa fa-redo'></span>",this.redoButton.addEventListener("click",this.handleRedo),this.container.appendChild(this.undoButton),this.container.appendChild(this.redoButton)}handleUndo(){console.log("Undo action triggered")}handleRedo(){console.log("Redo action triggered")}render(e){e.appendChild(this.container)}}class ne extends S{constructor(){super(),this.container=document.createElement("div"),this.selectionDiv=document.createElement("div"),this.themeOptions=document.createElement("div"),this.selectedTheme=document.createElement("span"),this.init(),document.addEventListener("click",this.handleOutsideClick.bind(this))}init(){this.container.classList.add("tb-custom-theme-selection");const e=document.createElement("button");e.classList.add("theme-select-button"),e.setAttribute("aria-haspopup","listbox"),this.selectedTheme.classList.add("selected-theme-value"),this.selectedTheme.textContent="Select Theme",e.appendChild(this.selectedTheme),this.container.appendChild(e),e.onclick=t=>{t.preventDefault(),e.classList.contains("open")?this.closeSelection():(this.themeOptions.classList.toggle("show"),e.classList.toggle("open"),e.setAttribute("aria-expanded","true"))},this.selectionDiv.appendChild(e),this.container.appendChild(this.selectionDiv),this.initializeCategoryOptions()}initializeCategoryOptions(){this.themeOptions.className="theme-options-list",this.themeOptions.setAttribute("role","listbox"),this.getThemes().forEach((e=>{const t=document.createElement("div");t.className="theme-option",t.role="option",t.setAttribute("data-value",e.ThemeName),t.textContent=e.ThemeName;const n=this.currentTheme;n&&n.ThemeName===e.ThemeName&&(t.classList.add("selected"),this.selectedTheme.textContent=e.ThemeName),t.onclick=()=>{this.themeOptions.querySelectorAll(".theme-option").forEach((e=>e.classList.remove("selected"))),t.classList.add("selected"),this.selectedTheme.textContent=e.ThemeName,this.saveSelectedTheme(e),this.closeSelection()},this.themeOptions.appendChild(t)})),this.selectionDiv.appendChild(this.themeOptions)}saveSelectedTheme(e){(new a).updateLocationTheme(e.ThemeId).then((t=>{this.setTheme(e)}))}closeSelection(){if(this.themeOptions.classList.contains("show")){this.themeOptions.classList.remove("show");const e=this.container.querySelector(".theme-select-button");e.setAttribute("aria-expanded","false"),e.classList.toggle("open")}}handleOutsideClick(e){this.themeOptions.classList.contains("show")&&!this.container.contains(e.target)&&this.closeSelection()}render(e){e.appendChild(this.container)}}class ie{constructor(e){this.formField=document.createElement("div"),this.formField.className="form-field",this.formField.style.marginBottom="10px";const t=document.createElement("label");e.label&&(t.htmlFor=e.id,t.textContent=e.label);const n=document.createElement("input");n.type=e.type,n.id=e.id,n.className="tb-form-control",n.value=e.value||"",e.placeholder&&(n.placeholder=e.placeholder),e.required&&(n.required=!0);const i=document.createElement("span");i.className="error-message",i.style.cssText="\n            color: red;\n            font-size: 12px;\n            display: none;\n            margin-top: 5px;\n            font-weight: 300;\n        ",i.textContent=e.errorMessage||"Error message",e.label&&this.formField.appendChild(t),this.formField.appendChild(n),this.formField.appendChild(i)}getElement(){return this.formField}showError(e){const t=this.formField.querySelector(".error-message");t.style.display="block",e&&(t.textContent=e)}hideError(){this.formField.querySelector(".error-message").style.display="none"}}class ae{constructor(e){this.form=document.createElement("form"),this.form.id=e,this.fields=[]}addField(e){const t=new ie(e);return this.fields.push(t),this.form.appendChild(t.getElement()),t}render(e){e.appendChild(this.form)}getData(){const e={};return this.fields.forEach((t=>{const n=t.getElement().querySelector("input");e[n.id]=n.value})),e}}var oe=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class se extends S{constructor(){super(),this.toolboxService=new a,this.container=document.createElement("div"),this.selectionDiv=document.createElement("div"),this.versionSelection=document.createElement("div"),this.activeVersion=document.createElement("span"),this.init(),document.addEventListener("click",this.handleOutsideClick.bind(this))}init(){this.container.classList.add("tb-custom-theme-selection");const e=document.createElement("button");e.classList.add("theme-select-button"),e.setAttribute("aria-haspopup","listbox"),this.activeVersion.classList.add("selected-theme-value"),this.activeVersion.textContent="Select Theme",e.appendChild(this.activeVersion),this.container.appendChild(e),e.onclick=t=>{t.preventDefault(),e.classList.contains("open")?this.closeSelection():(this.versionSelection.classList.toggle("show"),e.classList.toggle("open"),e.setAttribute("aria-expanded","true"))},this.selectionDiv.appendChild(e),this.container.appendChild(this.selectionDiv),this.initializeVersionOptions()}initializeVersionOptions(){return oe(this,void 0,void 0,(function*(){this.versionSelection.className="theme-options-list",this.versionSelection.setAttribute("role","listbox");const e=new a;(yield e.getVersions()).AppVersions.forEach((e=>{const t=document.createElement("div");t.className="theme-option",t.role="option",t.setAttribute("data-value",e.AppVersionName),t.textContent=e.AppVersionName;const n=document.createElement("span");n.className="clone-version fa fa-clone",n.title="Duplicate",t.append(n),e.IsActive&&(t.classList.add("selected"),this.activeVersion.textContent=e.AppVersionName),n.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),this.createVersionModal(e.AppVersionName+" - Cop","Duplicate version","Duplicate")})),t.addEventListener("click",(n=>oe(this,void 0,void 0,(function*(){n.target.classList.contains("clone-version")||(this.versionSelection.querySelectorAll(".theme-option").forEach((e=>e.classList.remove("selected"))),t.classList.add("selected"),this.activeVersion.textContent=e.AppVersionName,yield this.toolboxService.activateVersion(e.AppVersionId).then((e=>{e&&this.clearActiveTheme()})).catch((e=>console.error("Version activation failed:",e))).finally((()=>this.closeSelection())),this.closeSelection())})))),this.versionSelection.appendChild(t)}));const t=document.createElement("div");t.className="theme-option",t.innerHTML='<i class="fa fa-plus"></i> Create new version',t.onclick=()=>{this.createVersionModal()},this.versionSelection.appendChild(t),this.selectionDiv.appendChild(this.versionSelection)}))}clearActiveTheme(){location.reload()}createVersionModal(e,t,n){const i=new ae("page-form");i.addField({type:"text",id:"version_name",placeholder:"Version name",required:!0,value:e});const a=document.createElement("div");i.render(a);const o=document.createElement("div");o.classList.add("popup-footer"),o.style.marginBottom="-12px";const s=this.createButton("submit_form","tb-btn-primary",`${n||"Save"}`),l=this.createButton("cancel_form","tb-btn-secondary","Cancel");o.appendChild(s),o.appendChild(l),a.appendChild(o);const r=new I({title:t||"Create new version",width:"400px",body:a});r.open(),s.addEventListener("click",(e=>{e.preventDefault();const t=a.querySelector("#version_name").value;t&&this.toolboxService.createVersion(t).then((e=>{r.close(),this.refreshVersionList()}))})),l.addEventListener("click",(e=>{e.preventDefault(),r.close()}))}refreshVersionList(){return oe(this,void 0,void 0,(function*(){this.versionSelection.classList.toggle("show");const e=this.container.querySelector(".theme-select-button");e.classList.toggle("open"),e.setAttribute("aria-expanded","true"),this.versionSelection.innerHTML="",yield this.initializeVersionOptions()}))}closeSelection(){if(this.versionSelection.classList.contains("show")){this.versionSelection.classList.remove("show");const e=this.container.querySelector(".theme-select-button");e.setAttribute("aria-expanded","false"),e.classList.toggle("open")}}handleOutsideClick(e){this.versionSelection.classList.contains("show")&&!this.container.contains(e.target)&&this.closeSelection()}createButton(e,t,n){const i=document.createElement("button");return i.id=e,i.classList.add("tb-btn",t),i.innerText=n,i}render(e){e.appendChild(this.container)}}var le=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class re{constructor(){this.appVersions=new T,this.container=document.getElementById("navbar-buttons"),this.init()}init(){const e=document.createElement("button");e.innerText="Debug",e.classList.add("tb-btn","tb-btn-outline"),e.style.marginRight="10px",e.id="debug-button",e.addEventListener("click",(e=>{e.preventDefault(),this.showProgressModal(),this.debugApp()}));const t=new te,n=new ne,i=new se;let a=new ee("open-mapping","Tree",{svg:'<svg xmlns="http://www.w3.org/2000/svg" width="18.818" height="16" viewBox="0 0 18.818 18">\n        <path id="Path_993" data-name="Path 993" d="M19.545,5a3.283,3.283,0,0,0-3.273,3.273A3.228,3.228,0,0,0,16.784,10l-2.541,3.177H10.427a3.273,3.273,0,1,0,0,1.636h3.816L16.784,18a3.229,3.229,0,0,0-.511,1.732,3.273,3.273,0,1,0,3.273-3.273,3.207,3.207,0,0,0-1.563.419L15.685,14l2.3-2.873a3.207,3.207,0,0,0,1.563.419,3.273,3.273,0,0,0,0-6.545Zm0,1.636a1.636,1.636,0,1,1-1.636,1.636A1.623,1.623,0,0,1,19.545,6.636ZM7.273,12.364A1.636,1.636,0,1,1,5.636,14,1.623,1.623,0,0,1,7.273,12.364Zm12.273,5.727a1.636,1.636,0,1,1-1.636,1.636A1.623,1.623,0,0,1,19.545,18.091Z" transform="translate(-4 -5)"></path>\n        </svg>',variant:"outline",labelId:"navbar_tree_label"}),o=new ee("publish","Publish",{svg:'<svg xmlns="http://www.w3.org/2000/svg" width="13" height="16" viewBox="0 0 13 18">\n        <path id="Path_958" data-name="Path 958" d="M13.5,3.594l-.519.507L7.925,9.263l1.038,1.06,3.814-3.9V18.644h1.444V6.429l3.814,3.9,1.038-1.06L14.019,4.1ZM7,20.119v1.475H20V20.119Z" transform="translate(-7 -3.594)" fill="#fff"></path>\n      </svg>',labelId:"navbar_tree_label"});t.render(this.container),i.render(this.container),n.render(this.container),this.container.appendChild(e),a.render(this.container),o.render(this.container),o.button.addEventListener("click",(e=>{e.preventDefault(),(new Q).openModal()}))}showProgressModal(){const e=document.createElement("div");e.id="debug-modal",e.style.textAlign="center";const t=document.createElement("span");t.innerHTML='<div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>';const n=document.createElement("p");n.textContent="Debugging in progress please wait...",e.appendChild(t),e.appendChild(n),new I({title:"App debugging",width:"500px",body:e}).open()}debugApp(){return le(this,void 0,void 0,(function*(){try{this.getAppUrls();const e=yield this.getAppUrls(),t=new a,n=(yield t.debugApp(e)).DebugResults;console.log(n);const i=document.createElement("div");i.innerHTML=`\n          <h3>Summary</h3>\n          <p>Total URLs checked: ${n.Summary.TotalUrls}</p>\n          <p>Valid URLs: ${n.Summary.SuccessCount}</p>\n          <p>Invalid URLs: ${n.Summary.FailureCount}</p>\n          <p>Completion time: ${(new Date).toLocaleTimeString()}</p>`,this.updateModalContent(i)}catch(e){console.error("Error:",e),this.updateModalContent("An error occurred during debugging.")}}))}getAppUrls(){return le(this,void 0,void 0,(function*(){var e,t;let n=[];const i=(yield this.appVersions.getActiveVersion()).Pages;for(const a of i){const i=null===(e=a.PageMenuStructure)||void 0===e?void 0:e.Rows;if(i)for(const e of i){const i=e.Tiles;if(i)for(const e of i)(null===(t=e.Action)||void 0===t?void 0:t.ObjectUrl)&&n.push(e.Action.ObjectUrl)}}return n}))}updateModalContent(e){const t=document.getElementById("debug-modal");t&&(t.innerHTML=`${e.innerHTML}`)}render(e){e.appendChild(this.container)}}class ce{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.classList.add("tb-tabs");const e=document.createElement("button");e.id="pages-button",e.className="tb-tab-button active",e.setAttribute("data-tab","pages");const t=document.createElement("span");t.id="sidebar_tabs_pages_label",t.innerText="Pages",e.appendChild(t);const n=document.createElement("button");n.id="templates-button",n.className="tb-tab-button",n.setAttribute("data-tab","templates");const i=document.createElement("span");i.id="sidebar_tabs_templates_label",i.innerText="Templates",n.appendChild(i),e.addEventListener("click",(t=>{t.preventDefault(),null==e||e.classList.add("active"),null==n||n.classList.remove("active"),this.switchTabs("pages-content","templates-content")})),n.addEventListener("click",(t=>{t.preventDefault(),null==n||n.classList.add("active"),null==e||e.classList.remove("active"),this.switchTabs("templates-content","pages-content")})),this.container.appendChild(e),this.container.appendChild(n)}switchTabs(e,t){const n=document.getElementById(e),i=document.getElementById(t);console.log(n,i),n.style.display="block",i.style.display="none"}render(e){e.appendChild(this.container)}}class de{constructor(e,t,n=5e3){this.closeTimeout=null,this.alertContainer=document.createElement("div"),this.alertContainer.className="tb-alerts-container",this.alertContainer.id="tb-alerts-container",this.alertElement=document.createElement("div"),this.alertElement.className=`tb-alert ${e}`,this.alertElement.style.display="flex",this.alertElement.style.opacity="0",this.alertElement.id=Math.random().toString(36);const i=document.createElement("div");i.className="tb-alert-header";const a=document.createElement("strong");a.textContent=e.charAt(0).toUpperCase()+e.slice(1);const o=document.createElement("span");o.className="tb-alert-close-btn",o.textContent="",o.addEventListener("click",(()=>this.close())),i.appendChild(a),i.appendChild(o);const s=document.createElement("p");s.textContent=t,this.alertElement.appendChild(i),this.alertElement.appendChild(s),this.alertContainer.appendChild(this.alertElement),document.body.appendChild(this.alertContainer),setTimeout((()=>this.alertElement.style.opacity="1"),50),this.closeTimeout=window.setTimeout((()=>this.close()),n)}close(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null),this.alertElement.style.opacity="0",setTimeout((()=>this.alertElement.remove()),500)}}class he{createForm(e,t){const n=new ae(e);return t.forEach((e=>n.addField(e))),n}createModal({title:e,form:t,onSave:n}){const i=document.createElement("div");t.render(i);const a=document.createElement("div");a.classList.add("popup-footer"),a.style.marginBottom="-12px";const o=this.createButton("submit_form","tb-btn-primary","Save"),s=this.createButton("cancel_form","tb-btn-secondary","Cancel");a.appendChild(o),a.appendChild(s);const l=document.createElement("div");l.appendChild(i),l.appendChild(a);const r=new I({title:e,width:"500px",body:l});r.open(),o.addEventListener("click",(e=>{e.preventDefault(),this.validateFields(t)&&(n(),r.close())})),s.addEventListener("click",(e=>{e.preventDefault(),r.close()}))}createButton(e,t,n){const i=document.createElement("button");return i.id=e,i.classList.add("tb-btn",t),i.innerText=n,i}validateFields(e){let t=!0;const n=e.fields;return n.forEach((e=>e.hideError())),n.forEach((e=>{const n=e.getElement().querySelector("input"),i=n.value.trim();n.required&&""===i?(e.showError(e.errorMessage),t=!1):e.minLength&&i.length<e.minLength?(e.showError(`Must be at least ${e.minLength} characters`),t=!1):e.maxLength&&i.length>e.maxLength?(e.showError(`Cannot exceed ${e.maxLength} characters`),t=!1):e.validate&&!e.validate(i)?(e.showError(e.errorMessage),t=!1):"home"!==i.toLowerCase()&&"my care"!==i.toLowerCase()&&"my living"!==i.toLowerCase()&&"my services"!==i.toLowerCase()&&"web link"!==i.toLowerCase()&&"dynamic form"!==i.toLowerCase()||(e.showError("Field name already exists"),t=!1)})),t}isValidUrl(e){try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}}}var pe=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class ue{constructor(){this.appVersionManager=new T,this.toolBoxService=new a,this.formModalService=new he}addNewService(){}addNewContentPage(){const e=this.formModalService.createForm("conent-page-form",[{label:"Page Title",type:"text",id:"page_title",placeholder:"Enter page title",required:!0,errorMessage:"Please enter a page title",minLength:3,maxLength:50}]);this.formModalService.createModal({title:"Add New Content Page",form:e,onSave:()=>this.processContentPageData(e.getData())})}addNewMenuPage(){const e=this.formModalService.createForm("menu-page-form",[{label:"Page Title",type:"text",id:"page_title",placeholder:"Enter page title",required:!0,errorMessage:"Please enter a page title",minLength:3,maxLength:50}]);this.formModalService.createModal({title:"Add New Menu Page",form:e,onSave:()=>this.processMenuPageData(e.getData())})}handleWebLinks(){const e=this.formModalService.createForm("web-link-form",[{label:"Link Url",type:"text",id:"link_url",placeholder:"https://example.com",required:!0,errorMessage:"Please enter a valid URL",validate:this.formModalService.isValidUrl},{label:"Link Label",type:"text",id:"link_label",placeholder:"Example Link",required:!0,errorMessage:"Please enter a label for your link",minLength:2}]);this.formModalService.createModal({title:"Add Web Link",form:e,onSave:()=>this.processFormData(e.getData())})}handleDynamicForms(e){return pe(this,void 0,void 0,(function*(){const t=globalThis.selectedComponent;if(!t)return;const n=t.find(".tile-title")[0];n&&n.components(e.PageName);const a=t.parent().getId(),o=t.parent().parent().getId(),s=(yield this.appVersionManager.getActiveVersion()).Pages.find((e=>"Dynamic Form"===e.PageName&&"DynamicForm"===e.PageType)),l=`${i}/utoolboxdynamicform.aspx?WWPFormId=${e.PageId}&WWPDynamicFormMode=DSP&DefaultFormType=&WWPFormType=0`,r=[["Text",e.PageName],["Name",e.PageName],["Action.ObjectType","Web Link"],["Action.ObjectId",null==s?void 0:s.PageId],["Action.ObjectUrl",l]];this.updateActionListDropDown("Dynamic Form",e.PageName);for(const[e,t]of r)globalThis.tileMapper.updateTile(a,e,t);const c=globalThis.tileMapper.getTile(o,a);new V(null==s?void 0:s.PageId,s).init(c)}))}processMenuPageData(e){return pe(this,void 0,void 0,(function*(){const t=yield this.appVersionManager.getActiveVersion();this.toolBoxService.createMenuPage(t.AppVersionId,e.page_title).then((e=>{this.updateActionListDropDown("Home",e.MenuPage.PageName),this.updateTileAfterPageCreation(e.MenuPage),new de("success","Page created successfully")}))}))}processContentPageData(e){return pe(this,void 0,void 0,(function*(){const t=yield this.appVersionManager.getActiveVersion();this.toolBoxService.createContentPage(t.AppVersionId,e.page_title).then((e=>{this.updateTileAfterPageCreation(e.ContentPage),new de("success","Page created successfully")}))}))}updateActionListDropDown(e,t){var n;const i=document.getElementById("dropdownMenu");null===(n=i.querySelector("details"))||void 0===n||n.removeAttribute("open"),i.style.display="none";const a=document.querySelector(".tb-dropdown-header"),o=a.querySelector("#sidebar_select_action_label"),s=a.querySelector("i");s.classList.remove("fa-angle-up"),s.classList.add("fa-angle-down"),o.innerText=`${e.length>14?e.substring(0,14)+"...":e}, ${t.length>14?t.substring(0,14)+"...":t}`}updateTileAfterPageCreation(e){return pe(this,void 0,void 0,(function*(){const t=globalThis.selectedComponent;if(!t)return;const n=t.find(".tile-title")[0];n&&n.components(e.PageName);const i=t.parent().getId(),a=t.parent().parent().getId(),o=globalThis.tileMapper.getTile(a,i),s=[["Text",e.PageName],["Name",e.PageName],["Action.ObjectType","Page"],["Action.ObjectId",e.PageId]];for(const[e,t]of s)globalThis.tileMapper.updateTile(i,e,t);const l=yield this.appVersionManager.getActiveVersion();this.attachPage(e,l,o)}))}attachPage(e,t,n){(new ge).removeOtherEditors(),new V(e.PageId,e).init(n)}processFormData(e){return pe(this,void 0,void 0,(function*(){const t=globalThis.selectedComponent;if(!t)return;const n=t.find(".tile-title")[0];n&&n.components(e.link_label);const i=t.parent().getId(),a=t.parent().parent().getId(),o=(yield this.appVersionManager.getActiveVersion()).Pages.find((e=>"Web Link"===e.PageName&&"WebLink"===e.PageType)),s=[["Text",e.link_label],["Name",e.link_label],["Action.ObjectType","Web Link"],["Action.ObjectId",null==o?void 0:o.PageId],["Action.ObjectUrl",e.link_url]];for(const[e,t]of s)globalThis.tileMapper.updateTile(i,e,t);const l=globalThis.tileMapper.getTile(a,i);new V(null==o?void 0:o.PageId,o).init(l)}))}}var me=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class ge{constructor(){this.appVersionManager=new T,this.toolboxService=new a}attachNewServiceToTile(e){return me(this,void 0,void 0,(function*(){const t=(yield this.toolboxService.getServices()).find((t=>t.ProductServiceId==e));if(t){const n={PageId:e,PageName:t.ProductServiceName,TileName:t.ProductServiceTileName};this.attachToTile(n,"Service/Product Page")}}))}attachToTile(e,t){return me(this,void 0,void 0,(function*(){const t=globalThis.selectedComponent;if(!t)return;const n=t.find(".tile-title")[0];n&&n.components(e.PageName);const i=t.parent().getId(),a=t.parent().parent().getId();if(globalThis.currentPageId===e.PageId)return void new de("error","Page cannot be linked to itself");const o=[["Text",e.PageName],["Name",e.PageName],["Action.ObjectType","Service/Product Page"],["Action.ObjectId",e.PageId]];for(const[e,t]of o)globalThis.tileMapper.updateTile(i,e,t);const s=globalThis.tileMapper.getTile(a,i);(new ue).updateActionListDropDown("Dynamic Form",e.PageName);const l=yield this.appVersionManager.getActiveVersion();this.attachPage(e,l,s)}))}attachPage(e,t,n){const i=e.PageId,a=(null==t?void 0:t.Pages.find((e=>e.PageId===i)))||null;this.removeOtherEditors(),a?new V(e.PageId,a).init(n):this.toolboxService.createServicePage(t.AppVersionId,i).then((e=>{new V(e.ContentPage.PageId,e.ContentPage).init(n)}))}removeOtherEditors(){const e=globalThis.frameId;document.querySelectorAll(".mobile-frame").forEach((t=>{if(t.id.includes(e)){let e=t.nextElementSibling;for(;e;){const t=e;e=e.nextElementSibling,t&&(t.remove(),(new R).activateNavigators())}}}))}updateActionProperty(e,t){const n=document.querySelector("#sidebar_select_action_label");n&&(n.innerText=`${e}, ${t.length>10?t.substring(0,10)+"...":t}`)}}class ve{constructor(e){this.categoryData=e,this.pageAttacher=new ge,this.pageCreationService=new ue,this.details=document.createElement("details"),this.init()}init(){this.details.className="category",this.details.setAttribute("data-category",this.categoryData.name),this.createCategoryElement()}createCategoryElement(){var t,n;const i=document.createElement("summary");i.innerText=`${this.categoryData.name}`;const a=document.createElement("i");a.className="fa fa-angle-right","Web Link"!==this.categoryData.name&&i.appendChild(a);const o=document.createElement("div");o.className="search-container",o.innerHTML=`\n            <i class="fas fa-search search-icon"></i>\n            <input type="text" placeholder="Search" class="search-input" />\n            ${this.categoryData.canCreatePage?'<button title="Add New Service/Menu Page" class="add-new-service" id="add-new-service">\n            <i class="fa fa-plus"></i>\n            </button>':""}\n        `,this.categoryData.canCreatePage&&setTimeout((()=>{const t=o.querySelector("#add-new-service");t&&t.addEventListener("click",(t=>{if(t.preventDefault(),globalThis.selectedComponent){if("Content Page"==this.categoryData.name&&this.pageCreationService.addNewContentPage(),"Service/Product Page"==this.categoryData.name){const t=e.getInstance();console.log(t.addServiceButtonEvent),t.addServiceButtonEvent()}}else new de("error","Select tile to continue..")}))}),0);const s=document.createElement("ul");s.className="category-content",null===(n=null===(t=this.categoryData)||void 0===t?void 0:t.options)||void 0===n||n.forEach((e=>{const t=document.createElement("li");t.innerText=e.PageName,t.setAttribute("data-page-name",e.PageName),t.setAttribute("data-page-id",e.PageId),t.addEventListener("click",(t=>{t.preventDefault(),globalThis.selectedComponent?"Dynamic Forms"===this.categoryData.name?this.pageCreationService.handleDynamicForms(e):(console.log(e),alert(),this.pageAttacher.attachToTile(e,this.categoryData.name)):new de("error","Select tile to continue..")})),s.appendChild(t)}));const l=document.createElement("li");l.className="no-records-message",l.style.display="none",l.innerText="No records found",s.appendChild(l),this.details.addEventListener("toggle",(e=>{if("Web Link"!==this.categoryData.name){const e=i.querySelector("i");e&&(e.classList.toggle("fa-angle-right"),e.classList.toggle("fa-angle-down"))}else{if(!globalThis.selectedComponent)return void new de("error","Select tile to continue..");this.pageCreationService.handleWebLinks()}})),"Web Link"===this.categoryData.name?this.details.appendChild(i):(this.details.appendChild(i),this.details.appendChild(o),this.details.appendChild(s)),this.searchItemsEvent(o)}searchItemsEvent(e){const t=e.querySelector("input"),n=this.details.querySelector("ul");t.addEventListener("input",(e=>{const t=n.querySelector(".no-records-message");let i=!1;const a=e.target.value.toLowerCase().trim();Array.from(n.querySelectorAll("li:not(.no-records-message)")).forEach((e=>{var t,n;const o=(null!==(n=null===(t=e.textContent)||void 0===t?void 0:t.toLowerCase())&&void 0!==n?n:"").includes(a);e.style.display=o?"block":"none",o&&(i=!0)})),t&&(t.style.display=i?"none":"block")}))}render(e){e.appendChild(this.details)}}class fe{constructor(e){this.categoryView=new ve(e)}render(e){this.categoryView.render(e)}}var be=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class ye{constructor(){this.container=document.createElement("div"),this.toolBoxService=new a,this.init(),this.getPages()}init(){return be(this,void 0,void 0,(function*(){this.container.className="tb-dropdown-menu",this.container.id="dropdownMenu",(yield this.getCategoryData()).forEach((e=>{new fe(e).render(this.container)}))}))}getCategoryData(){return be(this,void 0,void 0,(function*(){return[{name:"Page",displayName:"Pages",label:"Pages",options:yield this.getPages(),canCreatePage:!0},{name:"Service/Product Page",displayName:"Service Pages",label:"Service Page",options:this.getServices(),canCreatePage:!0},{name:"Dynamic Forms",displayName:"Dynamic Forms",label:"Dynamic Forms",options:this.getDynamicForms(),canCreatePage:!1},{name:"Predefined Pages",displayName:"Modules",label:"Modules",options:yield this.getPredefinedPages(),canCreatePage:!1},{name:"Web Link",displayName:"Web Links",label:"Web Link",options:[],canCreatePage:!1},{name:"Content Page",displayName:"Content Page",label:"Content Page",options:yield this.getContentPages(),canCreatePage:!0}]}))}getDynamicForms(){return(this.toolBoxService.forms||[]).map((e=>({PageId:e.FormId,PageName:e.ReferenceName,TileName:e.ReferenceName})))}getServices(){return(this.toolBoxService.services||[]).map((e=>({PageId:e.ProductServiceId,PageName:e.ProductServiceName,TileName:e.ProductServiceTileName||e.ProductServiceName})))}getContentPages(){return be(this,void 0,void 0,(function*(){var e;try{return((null===(e=(yield this.toolBoxService.getVersions()).AppVersions.find((e=>e.IsActive)))||void 0===e?void 0:e.Pages)||[]).filter((e=>"Content"==e.PageType)).map((e=>({PageId:e.PageId,PageName:e.PageName,TileName:e.PageName})))}catch(e){throw console.error("Error fetching pages:",e),e}}))}getPages(){return be(this,void 0,void 0,(function*(){var e;try{return((null===(e=(yield this.toolBoxService.getVersions()).AppVersions.find((e=>e.IsActive)))||void 0===e?void 0:e.Pages)||[]).filter((e=>"Menu"==e.PageType&&"Home"!==e.PageName&&"My Care"!==e.PageName&&"My Living"!==e.PageName&&"My Services"!==e.PageName)).map((e=>({PageId:e.PageId,PageName:e.PageName,TileName:e.PageName})))}catch(e){throw console.error("Error fetching pages:",e),e}}))}getPredefinedPages(){return be(this,void 0,void 0,(function*(){var e;try{return((null===(e=(yield this.toolBoxService.getVersions()).AppVersions.find((e=>e.IsActive)))||void 0===e?void 0:e.Pages)||[]).filter((e=>"Content"==e.PageType&&"Home"!==e.PageName)).map((e=>({PageId:e.PageId,PageName:e.PageName,TileName:e.PageName})))}catch(e){throw console.error("Error fetching pages:",e),e}}))}render(e){e.appendChild(this.container)}}class Ce{constructor(){this.container=document.createElement("div"),this.init(),document.addEventListener("click",this.handleOutsideClick.bind(this))}init(){this.container.className="sidebar-section custom-select-container",this.container.id="select-container";const e=document.createElement("div");e.className="tb-dropdown",this.dropDownHeader=document.createElement("div"),this.dropDownHeader.className="tb-dropdown-header",this.dropDownHeader.innerHTML='\n            <span id="sidebar_select_action_label">Select Action</span>\n            <i class="fa fa-angle-down"></i>\n        ',this.actionListDropDown=new ye,this.dropDownHeader.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.toggleDropdown()})),e.appendChild(this.dropDownHeader),this.actionListDropDown.render(e),this.container.appendChild(e)}toggleDropdown(){const e=this.dropDownHeader.querySelector("i");e&&(e.classList.toggle("fa-angle-up"),e.classList.toggle("fa-angle-down"));const t=this.actionListDropDown.container;t.style.display="block"===t.style.display?"none":"block"}closeDropdown(){const e=this.dropDownHeader.querySelector("i");e&&(e.classList.remove("fa-angle-up"),e.classList.add("fa-angle-down")),this.actionListDropDown.container.style.display="none"}handleOutsideClick(e){"block"!==this.actionListDropDown.container.style.display||this.container.contains(e.target)||this.closeDropdown()}destroy(){document.removeEventListener("click",this.handleOutsideClick.bind(this))}render(e){e.appendChild(this.container)}}class we{constructor(){this.container=document.createElement("div"),this.selectionDiv=document.createElement("div"),this.categoryOptions=document.createElement("div"),this.selectedCategory=document.createElement("span"),this.themeManager=new S,this.init(),document.addEventListener("click",this.handleOutsideClick.bind(this))}init(){this.container.className="sidebar-section services-section",this.container.id="dropdownMenu",this.selectionDiv.className="tb-custom-category-selection";const e=document.createElement("button");e.className="category-select-button",e.setAttribute("aria-haspopup","listbox"),e.setAttribute("aria-expanded","false"),this.selectedCategory.className="selected-category-value",this.selectedCategory.textContent="General",e.appendChild(this.selectedCategory),e.onclick=t=>{t.preventDefault(),e.classList.contains("open")?this.closeSelection():(this.categoryOptions.classList.toggle("show"),e.classList.toggle("open"),e.setAttribute("aria-expanded","true"))},this.selectionDiv.appendChild(e),this.container.appendChild(this.selectionDiv),this.initializeCategoryOptions(),this.loadThemeIcons()}initializeCategoryOptions(){this.categoryOptions.className="category-options-list",this.categoryOptions.setAttribute("role","listbox"),["General","Services","Health","Living"].forEach((e=>{const t=document.createElement("div");t.className="category-option",t.role="option",t.setAttribute("data-value",e),t.textContent=e,t.onclick=()=>{this.categoryOptions.querySelectorAll(".category-option").forEach((e=>e.classList.remove("selected"))),t.classList.add("selected"),this.selectedCategory.textContent=e,this.loadThemeIcons(e),this.closeSelection()},this.categoryOptions.appendChild(t)})),this.selectionDiv.appendChild(this.categoryOptions)}closeSelection(){if(this.categoryOptions.classList.contains("show")){this.categoryOptions.classList.remove("show");const e=this.container.querySelector(".category-select-button");e.setAttribute("aria-expanded","false"),e.classList.toggle("open")}}loadThemeIcons(e="General"){document.querySelectorAll("#icons-list").forEach((e=>e.remove()));const t=document.createElement("div");t.classList.add("icons-list"),t.id="icons-list",new w(this.themeManager,e).render(t),this.container.appendChild(t)}handleOutsideClick(e){this.categoryOptions.classList.contains("show")&&!this.container.contains(e.target)&&this.closeSelection()}render(e){e.appendChild(this.container)}}class Te extends S{constructor(){super(),this.container=document.createElement("div"),this.init()}init(){this.container.className="sidebar-section theme-section",this.container.style.paddingTop="0px";const e=this.getActiveThemeColors();new c(e,"theme-color-palette").render(this.container)}render(e){e.appendChild(this.container)}}class Ee{constructor(e,t,n){this.container=document.createElement("div"),this.message=e,this.title=t,this.toolboxService=new a,this.mediaId=n,this.init()}init(){this.container.classList.add("popup-modal"),this.container.style.display="flex";const e=document.createElement("div");e.classList.add("popup");const t=document.createElement("div");t.classList.add("popup-header");const n=document.createElement("span");n.innerText=this.title;const i=document.createElement("button");i.classList.add("close"),i.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 21 21">\n                <path id="Icon_material-close" data-name="Icon material-close" d="M28.5,9.615,26.385,7.5,18,15.885,9.615,7.5,7.5,9.615,15.885,18,7.5,26.385,9.615,28.5,18,20.115,26.385,28.5,28.5,26.385,20.115,18Z" transform="translate(-7.5 -7.5)" fill="#6a747f" opacity="0.54"></path>\n            </svg>\n        ',i.addEventListener("click",(()=>{this.close()})),t.appendChild(n),t.appendChild(i);const a=document.createElement("hr"),o=document.createElement("div");o.classList.add("popup-body"),o.id="confirmation_modal_message",o.innerText=this.message;const s=document.createElement("div");s.classList.add("popup-footer");const l=document.createElement("button");l.className="tb-btn tb-btn-outline",l.id="cancel_confirmation",l.innerText="Cancel",l.addEventListener("click",(()=>{this.close()}));const r=document.createElement("button");r.className="tb-btn tb-btn-primary",r.id="confirm_action",r.innerText="Confirm",r.addEventListener("click",(e=>{return t=this,n=void 0,a=function*(){e.preventDefault();try{yield this.toolboxService.deleteMedia(this.mediaId),this.toolboxService.media=this.toolboxService.media.filter((e=>e.MediaId!==this.mediaId));const e=document.getElementById(this.mediaId);e&&e.remove(),0===this.toolboxService.media.length&&(document.querySelector(".modal-actions").style.display="none"),this.close()}catch(e){console.error("Error deleting media:",e)}},new((i=void 0)||(i=Promise))((function(e,o){function s(e){try{r(a.next(e))}catch(e){o(e)}}function l(e){try{r(a.throw(e))}catch(e){o(e)}}function r(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,l)}r((a=a.apply(t,n||[])).next())}));var t,n,i,a})),s.appendChild(r),s.appendChild(l),e.appendChild(t),e.appendChild(a),e.appendChild(o),e.appendChild(s),this.container.appendChild(e)}close(){this.container.remove()}render(e){e.appendChild(this.container)}}class Se{constructor(e){this.mediaFile=e,this.container=document.createElement("div"),this.init()}init(){this.container.className="file-item valid",this.container.id=this.mediaFile.MediaId;const e=document.createElement("img");e.src=this.mediaFile.MediaUrl,e.alt=this.mediaFile.MediaName,e.className="preview-image";const t=document.createElement("div");t.className="file-info";const n=document.createElement("div");n.className="file-name",n.innerText=this.mediaFile.MediaName;const i=document.createElement("div");i.className="file-size",i.innerText=this.formatBytes(this.mediaFile.MediaSize),t.appendChild(n),t.appendChild(i);const a=document.createElement("span");a.className="status-icon",a.style.color="green",this.setupItemClickEvent(a);const o=document.createElement("span");o.className="delete-media fa-regular fa-trash-can",o.title="Delete image",o.addEventListener("click",(e=>{e.stopPropagation(),this.deleteEvent()})),this.container.appendChild(e),this.container.appendChild(t),this.container.appendChild(a),this.container.appendChild(o)}formatBytes(e){const t=["Bytes","KB","MB","GB","TB"];if(0===e)return"0 Byte";const n=parseInt(Math.floor(Math.log(e)/Math.log(1024)).toString());return 0===n?e+" "+t[n]:(e/Math.pow(1024,n)).toFixed(1)+" "+t[n]}setupItemClickEvent(e){this.container.addEventListener("click",(()=>{document.querySelectorAll(".file-item").forEach((e=>{e.classList.remove("selected");const t=e.querySelector(".status-icon");t&&(t.innerHTML=e.classList.contains("invalid")?"":"")})),this.container.classList.contains("selected")?e.innerHTML="":e.innerHTML='\n                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="13.423" viewBox="0 0 18 13.423">\n                        <path id="Icon_awesome-check" data-name="Icon awesome-check" d="M6.114,17.736l-5.85-5.85a.9.9,0,0,1,0-1.273L1.536,9.341a.9.9,0,0,1,1.273,0L6.75,13.282l8.441-8.441a.9.9,0,0,1,1.273,0l1.273,1.273a.9.9,0,0,1,0,1.273L7.386,17.736A.9.9,0,0,1,6.114,17.736Z" transform="translate(0 -4.577)" fill="#3a9341"></path>\n                    </svg>\n                ',this.container.classList.toggle("selected"),this.setupModalActions()}))}setupModalActions(){var e,t;const n=document.querySelector(".modal-actions");if(!n)return;n.style.display="flex";const i=n.querySelector("#cancel-modal"),a=n.querySelector("#save-modal");if(!i||!a)return;const o=i.cloneNode(!0),s=a.cloneNode(!0);null===(e=i.parentNode)||void 0===e||e.replaceChild(o,i),null===(t=a.parentNode)||void 0===t||t.replaceChild(s,a);const l=document.querySelector(".tb-modal");l&&(o.addEventListener("click",(()=>{l.style.display="none",l.remove()})),s.addEventListener("click",(()=>{this.addImageToTile(),l.style.display="none",l.remove()})))}addImageToTile(){const e=globalThis.selectedComponent;if(e)try{const t=encodeURI(this.mediaFile.MediaUrl);e.addStyle({"background-image":`url(${t})`,"background-color":"transparent","background-size":"cover","background-position":"center","background-blend-mode":"overlay"}),globalThis.tileMapper.updateTile(e.parent().getId(),"BGImageUrl",t),globalThis.tileMapper.updateTile(e.parent().getId(),"Opacity","0");const n=e.parent(),i=n.parent(),a=globalThis.tileMapper.getTile(i.getId(),n.getId());e&&a&&new U(e,a).setTileAttributes()}catch(e){console.error("Error adding image to tile:",e)}}deleteEvent(){new Ee("Are you sure you want to delete this media file?","Delete media",this.mediaFile.MediaId).render(document.body)}getElement(){return this.container}render(e){e.appendChild(this.container)}}var Ie=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class Pe{constructor(e){this.fileListElement=null,this.progressIntervals={},this.type=e,this.modalContent=document.createElement("div"),this.toolboxService=new a,this.init()}init(){this.modalContent.className="tb-modal-content";const e=document.createElement("div");e.className="tb-modal-header";const t=document.createElement("h2");t.innerText="Upload";const n=document.createElement("span");n.className="close",n.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 21 21">\n              <path id="Icon_material-close" data-name="Icon material-close" d="M28.5,9.615,26.385,7.5,18,15.885,9.615,7.5,7.5,9.615,15.885,18,7.5,26.385,9.615,28.5,18,20.115,26.385,28.5,28.5,26.385,20.115,18Z" transform="translate(-7.5 -7.5)" fill="#6a747f" opacity="0.54"></path>\n            </svg>\n        ',n.addEventListener("click",(e=>{e.preventDefault();const t=this.modalContent.parentElement;t.style.display="none",null==t||t.remove()})),e.appendChild(t),e.appendChild(n);const i=document.createElement("div");i.className="modal-actions";const a=document.createElement("button");a.className="tb-btn tb-btn-outline",a.id="cancel-modal",a.innerText="Cancel",a.addEventListener("click",(e=>{e.preventDefault();const t=this.modalContent.parentElement;t.style.display="none",null==t||t.remove()}));const o=document.createElement("button");o.className="tb-btn tb-btn-primary",o.id="save-modal",o.innerText="Save",i.appendChild(a),i.appendChild(o),this.modalContent.appendChild(e),this.uploadArea(),this.createFileListElement(),this.loadMediaFiles(),this.modalContent.appendChild(i)}uploadArea(){const e=document.createElement("div");e.className="upload-area",e.id="uploadArea",e.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="40.999" height="28.865" viewBox="0 0 40.999 28.865">\n            <path id="Path_1040" data-name="Path 1040" d="M21.924,11.025a3.459,3.459,0,0,0-3.287,3.608,3.459,3.459,0,0,0,3.287,3.608,3.459,3.459,0,0,0,3.287-3.608A3.459,3.459,0,0,0,21.924,11.025ZM36.716,21.849l-11.5,14.432-8.218-9.02L8.044,39.89h41Z" transform="translate(-8.044 -11.025)" fill="#afadad"></path>\n          </svg>\n          <div class="upload-text">\n            <p>Drag and drop or <a href="#" id="browseLink">browse</a></p>\n        </div>\n        ',this.setupDragAndDrop(e),this.modalContent.appendChild(e)}createFileListElement(){this.fileListElement=document.createElement("div"),this.fileListElement.className="file-list",this.fileListElement.id="fileList";const e=document.createElement("div");e.className="loading-media",e.textContent="Loading media files...",this.fileListElement.appendChild(e),this.modalContent.appendChild(this.fileListElement)}loadMediaFiles(){return Ie(this,void 0,void 0,(function*(){try{const e=yield this.toolboxService.getMediaFiles();this.fileListElement&&(this.fileListElement.innerHTML="",e&&e.length>0&&e.forEach((e=>{new Se(e).render(this.fileListElement)})))}catch(e){console.error("Error loading media files:",e),this.fileListElement&&(this.fileListElement.innerHTML='<div class="error-message">Error loading media files. Please try again.</div>')}}))}setupDragAndDrop(e){return Ie(this,void 0,void 0,(function*(){const t=document.createElement("input");t.type="file",t.id="fileInput",t.multiple=!0,t.accept="image/jpeg, image/jpg, image/png",t.style.display="none",e.appendChild(t);const n=e.querySelector("#browseLink");null==n||n.addEventListener("click",(e=>{e.preventDefault(),t.click()})),e.addEventListener("click",(e=>{t.click()})),t.addEventListener("change",(()=>{t.files&&t.files.length>0&&this.handleFiles(t.files)})),e.addEventListener("dragover",(t=>{t.preventDefault(),e.classList.add("drag-over")})),e.addEventListener("dragleave",(t=>{t.preventDefault(),e.classList.remove("drag-over")})),e.addEventListener("drop",(t=>Ie(this,void 0,void 0,(function*(){var n;t.preventDefault(),e.classList.remove("drag-over"),(null===(n=t.dataTransfer)||void 0===n?void 0:n.files)&&t.dataTransfer.files.length>0&&(yield this.handleFiles(t.dataTransfer.files))}))))}))}handleFiles(e){return Ie(this,void 0,void 0,(function*(){const t=Array.from(e);for(const e of t)if(e.type.startsWith("image/"))try{const t=yield this.readFileAsDataURL(e),n=e.name.replace(/\s+/g,"-").replace(/[()]/g,""),i={MediaId:Date.now().toString(),MediaName:n,MediaUrl:t,MediaType:e.type,MediaSize:e.size};if(console.log(i),this.fileListElement&&this.displayMediaFileProgress(this.fileListElement,i),!this.validateFile(i))return;(yield this.toolboxService.uploadFile(i.MediaUrl,i.MediaName,i.MediaSize,i.MediaType)).BC_Trn_Media}catch(t){if(console.error("Error processing file:",t),this.fileListElement){const n=document.createElement("div");n.className="upload-error",n.textContent=`Error uploading ${e.name}: ${t}`,this.fileListElement.insertBefore(n,this.fileListElement.firstChild),setTimeout((()=>{n.remove()}),5e3)}}}))}displayMediaFileProgress(e,t){const n=document.createElement("div");n.className="file-item "+(this.validateFile(t)?"valid":"invalid"),n.setAttribute("data-mediaid",t.MediaId);const i=this.validateFile(t);var a;n.innerHTML=`\n              <img src="${t.MediaUrl}" alt="File thumbnail" class="preview-image">\n              <div class="file-info">\n                <div class="file-info-details">\n                  <div>\n                    <div class="file-name">${a=t.MediaName,a.split("-").slice(1).join("-")}</div>\n                    <div class="file-size">${this.formatFileSize(t.MediaSize.toString())}</div>\n                  </div>\n                  <div class="progress-text">0%</div>\n                </div>\n                <div class="progress-bar">\n                    <div class="progress" style="width: 0%"></div>\n                </div>\n                ${i?"":"<small>File is invalid. Please upload a valid file (jpg, png, jpeg and less than 2MB).</small>"}\n              </div>\n              <span class="status-icon" style="color: ${i?"green":"red"}">\n                ${i?"":""}\n              </span>\n              ${i?"":'<span style="margin-left: 10px" id="delete-invalid" class="fa-regular fa-trash-can"></span>'}\n            `,e.insertBefore(n,e.firstChild);const o=n.querySelector("#delete-invalid");o&&(o.style.cursor="pointer",o.addEventListener("click",(t=>{t.preventDefault(),e.removeChild(n)})));let s=0;const l=n.querySelector(".progress"),r=n.querySelector(".progress-text"),c=setInterval((()=>{s+=Math.floor(15*Math.random())+5,l&&(l.style.width=`${s>100?100:s}%`),r&&(r.textContent=`${s>100?100:s}%`),s>=100&&(clearInterval(c),i&&(e.removeChild(n),this.displayMediaFile(e,t)))}),300);this.progressIntervals=this.progressIntervals||{},this.progressIntervals[t.MediaId]=c}validateFile(e){const t=e.MediaSize<=2097152,n=["image/jpeg","image/jpg","image/png"].includes(e.MediaType);return t&&n}formatFileSize(e){const t=parseInt(e,10);return t<1024?t+" B":t<1048576?Math.round(t/1024)+" KB":(t/1048576).toFixed(2)+" MB"}displayMediaFile(e,t){const n=new Se(t);n.render(e),e.insertBefore(n.getElement(),e.firstChild)}destroy(){Object.values(this.progressIntervals).forEach((e=>{clearInterval(e)})),this.progressIntervals={}}readFileAsDataURL(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=()=>{i.result?t(i.result):n(new Error("FileReader did not produce a result"))},i.onerror=()=>{n(i.error)},i.readAsDataURL(e)}))}render(e){e.appendChild(this.modalContent)}}class Le{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.className="bg-section";const e=document.createElement("button");e.className="add-image",e.id="image-bg",e.innerHTML='\n            <span class="plus">\n               <i class="fa fa-plus"></i>\n            </span>\n            <span class="image-icon">\n                <i class="fa fa-image"></i>\n            </span>\n        ';const t=document.createElement("div");t.className="slider-wrapper",t.id="slider-wrapper",t.style.display="none";const n=document.createElement("input");n.type="range",n.id="bg-opacity",n.min="0",n.max="100",n.value="0",n.addEventListener("input",(e=>{const t=e.target.value,n=document.getElementById("valueDisplay");n&&(n.innerHTML=`${t}%`),this.updateImageOpacity(t)}));const i=document.createElement("span");i.id="valueDisplay",i.innerHTML="0%",t.appendChild(n),t.appendChild(i),e.addEventListener("click",(e=>{if(e.preventDefault(),!globalThis.selectedComponent)return;const t=document.createElement("div");t.classList.add("tb-modal"),t.style.display="flex",new Pe("tile").render(t);const n=document.createElement("input");n.type="file",n.multiple=!0,n.accept="image/jpeg, image/jpg, image/png",n.id="fileInput",n.style.display="none",document.body.appendChild(t),document.body.appendChild(n)})),this.container.appendChild(e),this.container.appendChild(t)}updateImageOpacity(e){const t=globalThis.selectedComponent;if(!t)return;const n=e/100;console.log(n),t.addStyle({"background-color":`rgba(0, 0, 0, ${n})`}),globalThis.tileMapper.updateTile(t.parent().getId(),"Opacity",e)}render(e){e.appendChild(this.container)}}class Ae{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.classList.add("tile-img-container"),this.container.id="tile-img-container";const e=document.createElement("img");e.alt="Tile Image",e.src="https://staging.comforta.yukon.software/media/receptie-197@3x.png",e.className="tile-img-thumbnail";const t=document.createElement("button");t.className="tile-img-delete-button",t.id="tile-img-delete-button",t.innerHTML='<i class="fa fa-xmark"></i>',t.addEventListener("click",(e=>{e.preventDefault();const t=globalThis.selectedComponent;if(!t)return;const n=t.parent(),i=n.parent(),a=globalThis.tileMapper.getTile(i.getId(),n.getId()),o=t.getStyle();delete o["background-image"],o["background-color"]=a.BGColor,t.setStyle(o),globalThis.tileMapper.updateTile(t.parent().getId(),"BGImageUrl",""),globalThis.tileMapper.updateTile(t.parent().getId(),"Opacity","0"),this.container.style.display="none",document.getElementById("slider-wrapper").style.display="none"})),this.container.appendChild(e),this.container.appendChild(t)}render(e){e.appendChild(this.container)}}class xe{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.classList.add("tile-img-section");const e=new Ae;(new Le).render(this.container),e.render(this.container)}render(e){e.appendChild(this.container)}}class Me{constructor(){this.input=document.createElement("input"),this.init()}init(){this.input.type="text",this.input.placeholder="Enter a title",this.input.classList.add("tb-form-control"),this.input.id="tile-title",this.input.addEventListener("input",(e=>{const t=globalThis.selectedComponent;if(!t)return;const n=t.closest(".container-row").components().length,i=t.find(".tile-title")[0];if(i){const e=3===n?this.truncate(11):2===n?this.truncate(14):this.truncate(25);i.components(e),i.addAttributes({title:this.input.value})}globalThis.tileMapper.updateTile(t.parent().getId(),"Text",this.input.value.trim())}))}truncate(e){return this.input.value.length>e?this.input.value.substring(0,e)+"..":this.input.value}render(e){e.appendChild(this.input)}}class $e{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.className="text-color-palette text-colors",this.container.id="text-color-palette",Object.entries({color1:"#ffffff",color2:"#333333"}).forEach((([e,t])=>{const n=document.createElement("div");n.className="color-item";const i=document.createElement("input");i.type="radio",i.id=`text-color-${e}`,i.name="text-color",i.value=t;const a=document.createElement("label");a.className="color-box",a.setAttribute("for",`text-color-${e}`),a.style.backgroundColor=t,a.setAttribute("data-tile-color",t),n.appendChild(i),n.appendChild(a),this.container.appendChild(n),a.onclick=e=>{e.preventDefault();const n=globalThis.selectedComponent;n&&(n.addStyle({color:t}),globalThis.tileMapper.updateTile(n.parent().getId(),"Color",t),i.checked=!0)}}))}render(e){e.appendChild(this.container)}}class Ne{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.classList.add("text-alignment");const e=document.createElement("div");e.classList.add("align-item"),e.innerHTML='\n            <input type="radio" id="tile-left"\n                name="alignment" value="left" />\n            <label for="tile-left" class="fas fa-align-left">\n            </label>\n        ';const t=document.createElement("div");t.classList.add("align-item"),t.innerHTML='\n            <input type="radio" id="tile-center"\n                     name="alignment" value="center" />\n            <label for="tile-center">\n                <svg xmlns="http://www.w3.org/2000/svg"\n                width="12.7" height="14.626"\n                viewBox="0 0 12.7 14.626">\n                <path id="Group_2344-converted"\n                    data-name="Group 2344-converted"\n                    d="M5.863,1.868V3.736L5.031,2.9,4.2,2.073l-.336.341-.336.342,1.411,1.41L6.35,5.577,7.758,4.17,9.165,2.762l-.333-.333L8.5,2.1l-.831.817-.83.817V0H5.863V1.868M0,7.313v.794H12.7V6.519H0v.794m4.937,3.149-1.4,1.4.333.333.334.333.83-.816.831-.817v3.729h.974V10.89l.832.832.831.832.336-.342.336-.341L7.766,10.465c-.773-.773-1.41-1.406-1.416-1.406s-.642.631-1.413,1.4"\n                    fill-rule="evenodd" fill="#696969" />\n                </svg>\n            </label>\n        ',e.onclick=e=>{e.preventDefault();const t=document.getElementById("tile-left"),n=globalThis.selectedComponent;if(!n)return;n.addStyle({"justify-content":"start","align-items":"start"});const i=n.find(".tile-title")[0];i&&i.addStyle({"text-align":"left"}),globalThis.tileMapper.updateTile(n.parent().getId(),"Align","left"),t.checked=!0},t.onclick=e=>{e.preventDefault();const t=document.getElementById("tile-center"),n=globalThis.selectedComponent;if(!n)return;n.addStyle({"justify-content":"center","align-items":"center"});const i=n.find(".tile-title")[0];i&&i.addStyle({"text-align":"center"}),globalThis.tileMapper.updateTile(n.parent().getId(),"Align","center"),t.checked=!0},this.container.appendChild(e),this.container.appendChild(t)}render(e){e.appendChild(this.container)}}class ke{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.classList.add("title-style");const e=new $e,t=new Ne;e.render(this.container),t.render(this.container)}render(e){e.appendChild(this.container)}}class je{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.className="sidebar-section title-section";const e=new Me,t=new ke;e.render(this.container),t.render(this.container)}render(e){e.appendChild(this.container)}}class De{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.id="menu-page-section";const e=new Te,t=new xe,n=new je,i=new Ce,a=new we;e.render(this.container),t.render(this.container),n.render(this.container),i.render(this.container),a.render(this.container)}render(e){e.appendChild(this.container)}}class Be{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.className="tb-tab-content active-tab",this.container.id="pages-content",(new De).render(this.container)}render(e){e.appendChild(this.container)}}class Oe{constructor(e){this.templateList=document.createElement("div"),this.templateList.id="page-templates",e.forEach(((e,t)=>{const n=document.createElement("div");n.className="page-template-wrapper";const i=document.createElement("div");i.className="page-template-block-number";const a=document.createElement("div");a.className="page-template-block",a.title="Click to select template";const o=document.createElement("div"),s=document.createElement("img");s.style.width="100%",s.style.height="100%",s.src=e.image,o.appendChild(s),a.appendChild(o),i.innerHTML=`${t+1}`,n.appendChild(i),n.appendChild(a),this.templateList.appendChild(n)}))}render(e){e.appendChild(this.templateList)}}class Ve{constructor(){this.container=document.createElement("div"),this.init()}init(){this.container.className="tb-tab-content active-tab",this.container.id="templates-content",this.container.style.display="none";const e=document.createElement("div");e.className="sidebar-section",e.id="page-templates",new Oe([{image:"/Resources/UCGrapes1/src/images/template-1.png"},{image:"/Resources/UCGrapes1/src/images/template-2.png"},{image:"/Resources/UCGrapes1/src/images/template-3.png"},{image:"/Resources/UCGrapes1/src/images/template-4.png"}]).render(e),this.container.appendChild(e)}render(e){e.appendChild(this.container)}}class Fe{constructor(){this.container=document.getElementById("tools-section"),this.init()}init(){const e=new ce,t=new Be,n=new Ve;e.render(this.container),t.render(this.container),n.render(this.container)}render(e){e.appendChild(this.container)}}var _e=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};class He{constructor(){this.appVersions=new T,this.toolboxService=new a,this.pageAttacher=new ge}setUpNavBar(){this.autoSave();const e=document.getElementById("tb-navbar"),t=document.getElementById("navbar_title");e&&t?(t.textContent="App toolbox",(new re).render(e)):console.error("Navigation bar elements not found!")}setUpSideBar(){const e=document.getElementById("tb-sidebar");(new Fe).render(e)}setUpScrollButtons(){const e=document.getElementById("child-container"),t=document.querySelector(".navigator .page-navigator-left"),n=document.querySelector(".navigator .page-navigator-right"),i=()=>{t.style.display=e.scrollLeft>0?"none":"block";const i=e.scrollWidth-e.clientWidth;n.style.display=e.scrollLeft<i-5?"none":"block"};t.onclick=()=>{e.scrollLeft-=300},n.onclick=()=>{e.scrollLeft+=300},e.addEventListener("scroll",i),window.addEventListener("resize",i),i()}autoSave(){const e=new Map;setInterval((()=>_e(this,void 0,void 0,(function*(){const t=yield this.appVersions.getActiveVersion();t.Pages.forEach((n=>_e(this,void 0,void 0,(function*(){const i=n.PageId,a=`data-${i}`,o=JSON.parse(localStorage.getItem(a)||"{}");let s=null;if("Menu"===n.PageType?s="PageMenuStructure":"Content"===n.PageType&&(s="PageContentStructure"),!s||!o[s])return;const l=JSON.stringify(o[s]);if(l!==n.PageStructure){const a={AppVersionId:t.AppVersionId,PageId:i,PageName:n.PageName,PageType:n.PageType,PageStructure:l};try{yield this.toolboxService.autoSavePage(a),e.set(i,l),this.openToastMessage()}catch(e){console.error(`Failed to save page ${n.PageName}:`,e)}}}))))}))),1e4)}openToastMessage(){const e=document.createElement("div");e.id="toast",e.textContent="Your changes are saved",document.body.appendChild(e),setTimeout((()=>{e.style.opacity="1",e.style.transform="translateX(-50%) translateY(0)"}),100),setTimeout((()=>{e.style.opacity="0",setTimeout((()=>{document.body.removeChild(e)}),500)}),3e3)}closeDropDowns(){}}const qe=class{constructor(){this.config=e.getInstance(),this.toolboxManager=new He,this.editor=new Y,this.config.isInitialized||console.error("ToolboxApp created before AppConfig was initialized!"),this.initialise()}initialise(){this.toolboxManager.setUpNavBar(),this.toolboxManager.setUpSideBar(),this.toolboxManager.closeDropDowns(),this.editor.init()}};window.App=class{constructor(t,n,i,a,o,s,l){e.getInstance().init(t,n,i,a,o,s,l),this.toolboxApp=new qe}}})();