<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>GrapesJS Editor</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/grapesjs/dist/css/grapes.min.css"
    />
    <script src="https://unpkg.com/grapesjs"></script>
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js"></script>
  </head>
  <body>
    lkclkxlcxkl
    <div id="gjs">hello</div>

    <script>
      const editor = grapesjs.init({
        container: "#gjs",
        fromElement: true,
        height: "100vh",
        storageManager: false,
        blockManager: {
          appendTo: "#gjs",
          blocks: [
            {
              id: "rich-text",
              label: "Rich Text",
              content: '<div class="rich-text-editor">Edit this text</div>',
              category: "Basic",
            },
          ],
        },
        // plugins: ["gjs-blocks-basic"],
        // pluginsOpts: {
        //   "gjs-blocks-basic": {
        //     block: ["text"],
        //   },
        // },
        assetManager: {
          upload: true,
          assets: [],
        },
        richTextEditor: {},
      });

      const rte = editor.RichTextEditor;

      rte.add("bold", {
        icon: "<b>List</b>",
        attributes: { title: "Bold" },
        result: (rte) => rte.exec("insertOrderedList"),
      });

      rte.add("list", {
        icon: `<select class="gjs-field">
        <option value="ul">Ul</option>
        <option value="ol">Ol</option>)`})
      rte.add("link", {
        icon: document.getElementById("t"),
        attributes: { title: "Link" },
        // Example on how to wrap selected content
        result: (rte) => rte.insertHTML(`<a href="#">${rte.selection()}</a>`),
      });


      // An example with fontSize
      rte.add("fontSize", {
        icon: `<select class="gjs-field">
        <option>1</option>
        <option>4</option>
        <option>7</option>
      </select>`,
        // Bind the 'result' on 'change' listener
        event: "change",
        result: (rte, action) =>
          rte.exec("fontSize", action.btn.firstChild.value),
        // Callback on any input change (mousedown, keydown, etc..)
        update: (rte, action) => {
          const value = rte.doc.queryCommandValue(action.name);
          if (value != "false") {
            // value is a string
            action.btn.firstChild.value = value;
          }
        },
      });
      // An example with state
      const isValidAnchor = (rte) => {
        // a utility function to help determine if the selected is a valid anchor node
        const anchor = rte.selection().anchorNode;
        const parentNode = anchor && anchor.parentNode;
        const nextSibling = anchor && anchor.nextSibling;
        return (
          (parentNode && parentNode.nodeName == "A") ||
          (nextSibling && nextSibling.nodeName == "A")
        );
      };
      rte.add("toggleAnchor", {
        icon: `<span style="transform:rotate(45deg)">&supdsub;</span>`,
        state: (rte, doc) => {
          if (rte && rte.selection()) {
            // `btnState` is a integer, -1 for disabled, 0 for inactive, 1 for active
            return isValidAnchor(rte) ? btnState.ACTIVE : btnState.INACTIVE;
          } else {
            return btnState.INACTIVE;
          }
        },
        result: (rte, action) => {
          if (isValidAnchor(rte)) {
            rte.exec("unlink");
          } else {
            rte.insertHTML(`<a class="link" href="">${rte.selection()}</a>`);
          }
        },
      });

      // Function to replace the div with the TinyMCE editor
      // editor.on('component:render', (model) => {
      //   if (model.get('type') === 'text') {
      //     const textElement = model.view.el;
      //     tinymce.init({
      //       target: textElement,
      //       menubar: false,
      //       plugins: 'link image code',
      //       toolbar: 'undo redo | styles | bold italic | alignleft aligncenter alignright | link image',
      //     });
      //   }
      // });
    </script>
  </body>
</html>
